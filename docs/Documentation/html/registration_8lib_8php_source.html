<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Pragyan CMS: cms/registration.lib.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>cms/registration.lib.php</h1>  </div>
</div>
<div class="contents">
<a href="registration_8lib_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;__PRAGYAN_CMS&#39;</span>))
<a name="l00003"></a>00003 { 
<a name="l00004"></a>00004         header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>].<span class="stringliteral">&#39; 403 Forbidden&#39;</span>);
<a name="l00005"></a>00005         echo <span class="stringliteral">&quot;&lt;h1&gt;403 Forbidden&lt;h1&gt;&lt;h4&gt;You are not authorized to access the page.&lt;/h4&gt;&quot;</span>;
<a name="l00006"></a>00006         echo <span class="stringliteral">&#39;&lt;hr/&gt;&#39;</span>.$_SERVER[<span class="stringliteral">&#39;SERVER_SIGNATURE&#39;</span>];
<a name="l00007"></a>00007         exit(1);
<a name="l00008"></a>00008 }
<a name="l00016"></a><a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">00016</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>() {
<a name="l00017"></a>00017         global <a class="code" href="icons_8lib_8php.html#aedb76478d4528f9a7238cb660ba23f41">$urlRequestRoot</a>, <a class="code" href="common_8lib_8php.html#aff25c40f48b4e124ac84533f8dbd0b4d">$moduleFolder</a>, <a class="code" href="icons_8lib_8php.html#a0fa2c9191ec4f6bb08bd885031af226c">$cmsFolder</a>,<a class="code" href="common_8lib_8php.html#af6e6b8785607da4a06f0ab2ebd67e518">$sourceFolder</a>, <a class="code" href="icons_8lib_8php.html#a2654f4b5167de5bf124544b36647f7c4">$templateFolder</a>;
<a name="l00018"></a>00018         require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformsubmit.php&quot;</span>);
<a name="l00019"></a>00019         require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformgenerate.php&quot;</span>);
<a name="l00020"></a>00020         $jsPath2 = <span class="stringliteral">&quot;$urlRequestRoot/$cmsFolder/$moduleFolder/form/validation.js&quot;</span>;<span class="comment">//validation.js</span>
<a name="l00021"></a>00021         $jsPath = <span class="stringliteral">&quot;$urlRequestRoot/$cmsFolder/templates/common/scripts/formValidator.js&quot;</span>;<span class="comment">//validation.js</span>
<a name="l00022"></a>00022         <a class="code" href="calendar_8php.html#aa2588075f0b00a15f0c43f8a4b857b6e">$calpath</a> = <span class="stringliteral">&quot;$urlRequestRoot/$cmsFolder/$moduleFolder&quot;</span>;
<a name="l00023"></a>00023         $jsPathMooTools = <span class="stringliteral">&quot;$urlRequestRoot/$cmsFolder/templates/common/scripts/mootools-1.11-allCompressed.js&quot;</span>;
<a name="l00024"></a>00024         $body = <span class="stringliteral">&#39;&lt;script language=&quot;javascript&quot; type=&quot;text/javascript&quot; src=&quot;&#39;</span>.$jsPath2.<span class="stringliteral">&#39;&quot;&gt;&lt;/script&gt;&#39;</span>;
<a name="l00025"></a>00025         $body .= <span class="stringliteral">&#39;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; media=&quot;all&quot; href=&quot;&#39;</span>.$calpath.<span class="stringliteral">&#39;/form/calendar/calendar.css&quot; title=&quot;Aqua&quot; /&gt;&#39;</span> .
<a name="l00026"></a>00026                                                  <span class="stringliteral">&#39;&lt;script type=&quot;text/javascript&quot; src=&quot;&#39;</span>.$calpath.<span class="stringliteral">&#39;/form/calendar/calendar.js&quot;&gt;&lt;/script&gt;&#39;</span>;
<a name="l00027"></a>00027 
<a name="l00028"></a>00028         $captchaHtml = <a class="code" href="registrationformgenerate_8php.html#ae33f8cad0244a22d9f496983a7e2b0b6">getCaptchaHtml</a>();
<a name="l00029"></a>00029         $jsValidationFunctions = array();
<a name="l00030"></a>00030         $containsFileUploadFields = <span class="keyword">false</span>;
<a name="l00031"></a>00031         $dynamicFields = <a class="code" href="registrationformgenerate_8php.html#a278216352f218654b56ca3fde52c62fd">getFormElementsHtmlAsArray</a>(0, 0, $jsValidationFunctions, $containsFileUploadFields);
<a name="l00032"></a>00032         $dynamicFields = join($dynamicFields, <span class="stringliteral">&quot;&lt;/tr&gt;\n&lt;tr&gt;&quot;</span>);
<a name="l00033"></a>00033         <span class="keywordflow">if</span>($dynamicFields != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00034"></a>00034                 $dynamicFields = <span class="stringliteral">&quot;&lt;tr&gt;$dynamicFields&lt;/tr&gt;&quot;</span>;
<a name="l00035"></a>00035         }
<a name="l00036"></a>00036         $jsValidationFunctions = join($jsValidationFunctions, <span class="stringliteral">&#39; &amp;&amp; &#39;</span>);
<a name="l00037"></a>00037         $reg_str =&lt;&lt;&lt;REG
<a name="l00038"></a>00038 &lt;script language=<span class="stringliteral">&quot;javascript&quot;</span>&gt;
<a name="l00039"></a>00039                         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> checkPassword(inputhandler2) {
<a name="l00040"></a>00040                                 inputhandler1=inputhandler2.form.user_password;
<a name="l00041"></a>00041                                 <span class="keywordflow">if</span>(inputhandler1.value!=inputhandler2.value) {
<a name="l00042"></a>00042                                         alert(<span class="stringliteral">&quot;Passwords do not match&quot;</span>);
<a name="l00043"></a>00043                                         inputhandler2.value=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00044"></a>00044                                         inputhandler1.value=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00045"></a>00045                                         inputhandler1.focus();
<a name="l00046"></a>00046                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00047"></a>00047                                 }
<a name="l00048"></a>00048                                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00049"></a>00049                         }
<a name="l00050"></a>00050                         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> checkRegistrationForm(inputhandler) {
<a name="l00051"></a>00051                                 <span class="keywordflow">if</span>(inputhandler.user_password.value.length==0) {
<a name="l00052"></a>00052                                         alert(<span class="stringliteral">&quot;Blank password not allowed.&quot;</span>);
<a name="l00053"></a>00053                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00054"></a>00054                                 }
<a name="l00055"></a>00055                                 <span class="keywordflow">if</span>(inputhandler.user_name.value.length==0) {
<a name="l00056"></a>00056                                         alert(<span class="stringliteral">&quot;Blank &#39;User name&#39; not allowed.&quot;</span>);
<a name="l00057"></a>00057                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00058"></a>00058                                 }
<a name="l00059"></a>00059                                 <span class="keywordflow">if</span>(inputhandler.user_fullname.value.length==0) {
<a name="l00060"></a>00060                                         alert(<span class="stringliteral">&quot;Blank &#39;Full name&#39; not allowed.&quot;</span>);
<a name="l00061"></a>00061                                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00062"></a>00062                                 }
<a name="l00063"></a>00063                                 <span class="keywordflow">return</span> (checkEmail(this.user_email)&amp;&amp;checkPassword(this.user_repassword));
<a name="l00064"></a>00064                         }
<a name="l00065"></a>00065 &lt;/script&gt;
<a name="l00066"></a>00066 &lt;<a class="code" href="classform.html">form</a> <span class="keyword">class</span>=<span class="stringliteral">&quot;cms-registrationform&quot;</span>  method=<span class="stringliteral">&quot;POST&quot;</span> <a class="code" href="template_8lib_8php.html#a824aa20276005f0889ccb9ff6f1c5efd">name</a>=<span class="stringliteral">&quot;user_reg_usrFrm&quot;</span> onsubmit=<span class="stringliteral">&quot;return checkRegistrationForm(this)&quot;</span> action=<span class="stringliteral">&quot;./+login&amp;subaction=register&quot;</span> enctype=<span class="stringliteral">&quot;multipart/form-data&quot;</span>&gt;
<a name="l00067"></a>00067         &lt;fieldset&gt;
<a name="l00068"></a>00068         &lt;legend&gt; Sign Up&lt;/legend&gt;
<a name="l00069"></a>00069                 &lt;table border=<span class="stringliteral">&quot;0&quot;</span> cellspacing=<span class="stringliteral">&quot;0&quot;</span> cellpadding=<span class="stringliteral">&quot;0&quot;</span>&gt;
<a name="l00070"></a>00070                &lt;tr&gt;     &lt;td&gt;&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;user_email&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;labelrequired&quot;</span>&gt;Email *&lt;/label&gt;&lt;/td&gt;
<a name="l00071"></a>00071                                 &lt;td&gt;&lt;input <a class="code" href="template_8lib_8php.html#a824aa20276005f0889ccb9ff6f1c5efd">name</a>=<span class="stringliteral">&quot;user_email&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user_email&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;required&quot;</span> onchange=<span class="stringliteral">&quot;if(this.length!=0) return checkEmail(this);&quot;</span> <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;text&quot;</span>&gt;&lt;/td&gt;
<a name="l00072"></a>00072            &lt;/tr&gt;
<a name="l00073"></a>00073            &lt;tr&gt; &lt;td&gt;&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;user_password&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;labelrequired&quot;</span>&gt;Password *&lt;/label&gt;&lt;/td&gt;
<a name="l00074"></a>00074                         &lt;td&gt;  &lt;input name=<span class="stringliteral">&quot;user_password&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user_password&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;required&quot;</span> <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;password&quot;</span>&gt;&lt;/td&gt;
<a name="l00075"></a>00075                 &lt;/tr&gt;
<a name="l00076"></a>00076                         &lt;tr&gt; &lt;td&gt;&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;user_repassword&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;labelrequired&quot;</span>&gt;Re-enter Password *&lt;/label&gt;&lt;/td&gt;
<a name="l00077"></a>00077                                 &lt;td&gt; &lt;input name=<span class="stringliteral">&quot;user_repassword&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user_repassword&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;required&quot;</span> onchange=<span class="stringliteral">&quot;if(this.length!=0) return checkPassword(this);&quot;</span> <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;password&quot;</span>&gt;&lt;/td&gt;
<a name="l00078"></a>00078                         &lt;/tr&gt;
<a name="l00079"></a>00079                         &lt;tr&gt;
<a name="l00080"></a>00080                                 &lt;td&gt;&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;user_name&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;labelrequired&quot;</span>&gt;User name *&lt;/label&gt;&lt;/td&gt;
<a name="l00081"></a>00081                                 &lt;td&gt;&lt;input name=<span class="stringliteral">&quot;user_name&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user_name&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;required&quot;</span> <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;text&quot;</span>&gt;&lt;/td&gt;
<a name="l00082"></a>00082                         &lt;/tr&gt;
<a name="l00083"></a>00083                         &lt;tr&gt;
<a name="l00084"></a>00084                                 &lt;td&gt;&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;user_fullname&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;labelrequired&quot;</span>&gt;Full Name *&lt;/label&gt;&lt;/td&gt;
<a name="l00085"></a>00085                                 &lt;td&gt;&lt;input name=<span class="stringliteral">&quot;user_fullname&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;user_fullname&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;required&quot;</span> <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;text&quot;</span>&gt;&lt;/td&gt;
<a name="l00086"></a>00086                         &lt;/tr&gt;
<a name="l00087"></a>00087                         $dynamicFields
<a name="l00088"></a>00088                         $captchaHtml
<a name="l00089"></a>00089                         &lt;tr&gt;
<a name="l00090"></a>00090                                 &lt;td colspan=<span class="stringliteral">&quot;2&quot;</span>&gt;* - Required Fields&amp;nbsp;&lt;/td&gt;
<a name="l00091"></a>00091                         &lt;/tr&gt;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093                         &lt;tr&gt;
<a name="l00094"></a>00094                                 &lt;td&gt;&lt;input <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;submit&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;submitbutton&quot;</span> value=<span class="stringliteral">&quot;Sign Up&quot;</span>&gt;&lt;/td&gt;
<a name="l00095"></a>00095                                 &lt;td&gt;&lt;a href=<span class="stringliteral">&quot;./+login&amp;subaction=register&amp;reSendKey=1&quot;</span>&gt;Resend Activation link?&lt;/a&gt; &lt;a href=<span class="stringliteral">&quot;./+login&quot;</span>&gt;Login?&lt;/a&gt;&lt;/td&gt;
<a name="l00096"></a>00096                         &lt;/tr&gt;
<a name="l00097"></a>00097                 &lt;/table&gt;
<a name="l00098"></a>00098         &lt;/fieldset&gt;
<a name="l00099"></a>00099 &lt;/form&gt;
<a name="l00100"></a>00100 REG;
<a name="l00101"></a>00101         $body .= $reg_str;
<a name="l00102"></a>00102         $body .= &lt;&lt;&lt;SCRIPT
<a name="l00103"></a>00103                         &lt;script language=<span class="stringliteral">&quot;javascript&quot;</span> type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;
<a name="l00104"></a>00104                         &lt;!--
<a name="l00105"></a>00105                                 <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> validate_form(thisform) {
<a name="l00106"></a>00106                                         <span class="keywordflow">return</span> ($jsValidationFunctions);
<a name="l00107"></a>00107                                 }
<a name="l00108"></a>00108                         --&gt;
<a name="l00109"></a>00109                         &lt;/script&gt;
<a name="l00110"></a>00110 SCRIPT;
<a name="l00111"></a>00111         <span class="keywordflow">return</span> $body;
<a name="l00112"></a>00112 }
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="registration_8lib_8php.html#acc294a6cc8e69743746820e3d15e3f78">00114</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <span class="keyword">register</span>() {
<a name="l00116"></a>00116         global <a class="code" href="index_8php.html#a37f70590d51d5f8313b7d109c3c19a6e" title="Folder containing the upload files, temporary files and session files.">$uploadFolder</a>,<a class="code" href="common_8lib_8php.html#af6e6b8785607da4a06f0ab2ebd67e518">$sourceFolder</a>,<a class="code" href="common_8lib_8php.html#aff25c40f48b4e124ac84533f8dbd0b4d">$moduleFolder</a>,<a class="code" href="icons_8lib_8php.html#aedb76478d4528f9a7238cb660ba23f41">$urlRequestRoot</a>;
<a name="l00117"></a>00117         require(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformgenerate.php&quot;</span>);
<a name="l00118"></a>00118         require(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformsubmit.php&quot;</span>);
<a name="l00119"></a>00119         <span class="keywordflow">if</span> ((!isset ($_GET[<span class="stringliteral">&#39;key&#39;</span>])) &amp;&amp; (!isset ($_GET[<span class="stringliteral">&#39;reSendKey&#39;</span>])) &amp;&amp; (!isset ($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]))) {      
<a name="l00120"></a>00120                 <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();           
<a name="l00121"></a>00121         }
<a name="l00123"></a>00123         elseif ((isset ($_GET[<span class="stringliteral">&#39;reSendKey&#39;</span>])) &amp;&amp; (!isset ($_POST[<span class="stringliteral">&#39;resend_key_email&#39;</span>])) &amp;&amp; <a class="code" href="index_8php.html#aae62d86fb3cee03afa9a3345c2801f3e" title="Whether to send a mail when a new user registers.">SEND_MAIL_ON_REGISTRATION</a>) {
<a name="l00124"></a>00124 
<a name="l00125"></a>00125                 $reSendForm =&lt;&lt;&lt;FORM
<a name="l00126"></a>00126 &lt;<a class="code" href="classform.html">form</a>  <span class="keyword">class</span>=<span class="stringliteral">&quot;cms-registrationform&quot;</span> method=<span class="stringliteral">&quot;POST&quot;</span> <a class="code" href="template_8lib_8php.html#a824aa20276005f0889ccb9ff6f1c5efd">name</a>=<span class="stringliteral">&quot;user_resend_key&quot;</span> onsubmit=<span class="stringliteral">&quot;return checkForm(this)&quot;</span> action=<span class="stringliteral">&quot;./+login&amp;subaction=register&amp;reSendKey&quot;</span>&gt;
<a name="l00127"></a>00127    &lt;fieldset&gt;
<a name="l00128"></a>00128    &lt;legend&gt;Resend Activation Link&lt;/legend&gt;
<a name="l00129"></a>00129    &lt;table&gt;
<a name="l00130"></a>00130                 &lt;tr&gt;
<a name="l00131"></a>00131                         &lt;td&gt;&lt;label <span class="keywordflow">for</span>=<span class="stringliteral">&quot;resend_key_email&quot;</span>  <span class="keyword">class</span>=<span class="stringliteral">&quot;labelrequired&quot;</span>&gt;Email&lt;/label&gt;&lt;/td&gt;
<a name="l00132"></a>00132                         &lt;td&gt;&lt;input <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;text&quot;</span> <a class="code" href="template_8lib_8php.html#a824aa20276005f0889ccb9ff6f1c5efd">name</a>=<span class="stringliteral">&quot;resend_key_email&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;resend_key_email&quot;</span> <span class="keyword">class</span>=<span class="stringliteral">&quot;required&quot;</span> onchange=<span class="stringliteral">&quot;if(this.length!=0) return checkEmail(this);&quot;</span>/&gt;&lt;br /&gt;&lt;/td&gt;
<a name="l00133"></a>00133                 &lt;/tr&gt;
<a name="l00134"></a>00134                 &lt;tr&gt;
<a name="l00135"></a>00135                         &lt;td colspan=<span class="stringliteral">&quot;2&quot;</span>&gt;&amp;nbsp;&lt;/td&gt;
<a name="l00136"></a>00136                 &lt;/tr&gt;
<a name="l00137"></a>00137                 &lt;tr&gt;
<a name="l00138"></a>00138                         &lt;td&gt;&lt;input type=<span class="stringliteral">&quot;submit&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&quot;submitbutton&quot;</span> value=<span class="stringliteral">&quot;Submit&quot;</span>&gt;&lt;/td&gt;
<a name="l00139"></a>00139                         &lt;td&gt;&lt;a href=<span class="stringliteral">&quot;./+login&amp;subaction=register&quot;</span>&gt;Sign Up&lt;/a&gt; &lt;a href=<span class="stringliteral">&quot;./+login&quot;</span>&gt;Login?&lt;/a&gt;&lt;/td&gt;
<a name="l00140"></a>00140                 &lt;/tr&gt;
<a name="l00141"></a>00141         &lt;/table&gt;
<a name="l00142"></a>00142         &lt;/fieldset&gt;
<a name="l00143"></a>00143 &lt;/form&gt;
<a name="l00144"></a>00144 FORM;
<a name="l00145"></a>00145                 <span class="keywordflow">return</span> $reSendForm;
<a name="l00146"></a>00146         }
<a name="l00148"></a>00148         elseif (isset ($_POST[<span class="stringliteral">&#39;resend_key_email&#39;</span>])) {
<a name="l00149"></a>00149                 $email = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;resend_key_email&#39;</span>]);
<a name="l00150"></a>00150                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;SELECT * FROM  `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users`  WHERE `user_email`=&#39;$email&#39; &quot;</span>;
<a name="l00151"></a>00151                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>) or <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(mysql_error() . <span class="stringliteral">&quot;registration L:131&quot;</span>);
<a name="l00152"></a>00152                 <span class="keywordflow">if</span> (!mysql_num_rows(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>))
<a name="l00153"></a>00153                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;This email-id has not yet been registered. Kindly &lt;a href=\&quot;./+login&amp;subaction=register\&quot;&gt;register&lt;/a&gt;.&quot;</span>);
<a name="l00154"></a>00154                 <span class="keywordflow">else</span> {
<a name="l00155"></a>00155                         $temp = mysql_fetch_assoc(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00156"></a>00156                         <span class="keywordflow">if</span> ($temp[<span class="stringliteral">&#39;user_activated&#39;</span>] == 1)
<a name="l00157"></a>00157                                 <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;E-mail $email has already been verified.&lt;a href=\&quot;./+login\&quot;&gt; Login&lt;/a&gt; &lt;a href=\&quot;./+login&amp;subaction=resetPasswd\&quot;&gt;Forgot Password?&lt;/a&gt;&quot;</span>);
<a name="l00158"></a>00158                         <span class="keywordflow">else</span> {
<a name="l00159"></a>00159                                 $key = <a class="code" href="registration_8lib_8php.html#a0168628c340092eabf2c2c4f7b642cf8">getVerificationKey</a>($email, $temp[<span class="stringliteral">&#39;user_password&#39;</span>], $temp[<span class="stringliteral">&#39;user_regdate&#39;</span>]);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161                                 <span class="comment">// send mail code starts here - see common.lib.php for more</span>
<a name="l00162"></a>00162                                 $from = <span class="stringliteral">&quot;from: &quot;</span>.CMS_TITLE.<span class="stringliteral">&quot; &lt;&quot;</span>.<a class="code" href="index_8php.html#ae32bfde794a614f2194100fbea8f0bc1" title="Email address to be used by CMS when sending mails to users.">CMS_EMAIL</a>.<span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l00163"></a>00163                                 $to = <span class="stringliteral">&quot;$email&quot;</span>;
<a name="l00164"></a>00164                                 $mailtype = <span class="stringliteral">&quot;activation_mail&quot;</span>;
<a name="l00165"></a>00165                                 
<a name="l00166"></a>00166                                 
<a name="l00167"></a>00167                                 $messenger = <span class="keyword">new</span> <a class="code" href="classmessenger.html">messenger</a>(<span class="keyword">false</span>);
<a name="l00168"></a>00168                                 global <a class="code" href="index_8php.html#a2e4dc0222b3edd3c006d48fd1dcb31e6" title="For example, if hosted on pragyan.org/10, $onlineSiteUrl = http://pragyan.org/10/home.">$onlineSiteUrl</a>;
<a name="l00169"></a>00169                                 $messenger-&gt;assign_vars(array(<span class="stringliteral">&#39;ACTIVATE_URL&#39;</span>=&gt;<span class="stringliteral">&quot;$onlineSiteUrl/+login&amp;subaction=register&amp;verify=$to&amp;key=$key&quot;</span>,<span class="stringliteral">&#39;NAME&#39;</span>=&gt;<span class="stringliteral">&quot;$temp[user_fullname]&quot;</span>,<span class="stringliteral">&#39;WEBSITE&#39;</span>=&gt;<a class="code" href="index_8php.html#a19bfcfd60c7a6722ee3dab8354e6aba1" title="Some of the previously defined global settings variables are converted into constants.">CMS_TITLE</a>,<span class="stringliteral">&#39;DOMAIN&#39;</span>=&gt;$onlineSiteUrl));
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                                 <span class="keywordflow">if</span> ($messenger-&gt;mailer($to,$mailtype,$key,$from))
<a name="l00172"></a>00172                                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;Activation link resent. Kindly check your e-mail for activation link.&quot;</span>);
<a name="l00173"></a>00173                                 <span class="keywordflow">else</span> 
<a name="l00174"></a>00174                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Activation link resending failure. Kindly contact administrator&quot;</span>);
<a name="l00175"></a>00175                                 <span class="comment">// send mail code ends here</span>
<a name="l00176"></a>00176                                                         
<a name="l00177"></a>00177                         }
<a name="l00178"></a>00178                 }
<a name="l00179"></a>00179         }
<a name="l00181"></a>00181         elseif (isset ($_GET[<span class="stringliteral">&#39;key&#39;</span>])) {
<a name="l00182"></a>00182                 $emailId = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_GET[<span class="stringliteral">&#39;verify&#39;</span>]);
<a name="l00183"></a>00183                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;SELECT * FROM  `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users`  WHERE `user_email`=&#39;{$emailId}&#39;&quot;</span>;
<a name="l00184"></a>00184                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>) or <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(mysql_error() . <span class="stringliteral">&quot;registration L:76&quot;</span>);
<a name="l00185"></a>00185                 $temp = mysql_fetch_assoc(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00186"></a>00186                 <span class="keywordflow">if</span> ($temp[<span class="stringliteral">&#39;user_activated&#39;</span>] == 1)
<a name="l00187"></a>00187                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;E-mail &quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_GET[verify]).<span class="stringliteral">&quot; has already been verified&quot;</span>);
<a name="l00188"></a>00188                 <span class="keywordflow">else</span> {
<a name="l00189"></a>00189                         <span class="keywordflow">if</span> ($_GET[<span class="stringliteral">&#39;key&#39;</span>] == <a class="code" href="registration_8lib_8php.html#a0168628c340092eabf2c2c4f7b642cf8">getVerificationKey</a>($_GET[<span class="stringliteral">&#39;verify&#39;</span>], $temp[<span class="stringliteral">&#39;user_password&#39;</span>], $temp[<span class="stringliteral">&#39;user_regdate&#39;</span>])) {
<a name="l00190"></a>00190                                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;UPDATE `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` SET `user_activated`=1  WHERE `user_email`=&#39;$emailId&#39;&quot;</span>;
<a name="l00191"></a>00191                                 mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>) or die(mysql_error());
<a name="l00192"></a>00192                                 <span class="keywordflow">if</span> (mysql_affected_rows() &gt; 0)
<a name="l00193"></a>00193                                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;Your e-mail &quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_GET[verify]).<span class="stringliteral">&quot; has been verified. Now you can fill your profile information by clicking &lt;a href=\&quot;./+profile\&quot;&gt;here&lt;/a&gt; or by clicking on the preferences link in the action bar any time you are logged in.&quot;</span>);
<a name="l00194"></a>00194                                 <span class="keywordflow">else</span>
<a name="l00195"></a>00195                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Verification error for &quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_GET[verify]).<span class="stringliteral">&quot;. Please contact administrator&quot;</span>);
<a name="l00196"></a>00196                         } <span class="keywordflow">else</span>
<a name="l00197"></a>00197                                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Verification error for &quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_GET[verify]).<span class="stringliteral">&quot;. Please contact administrator&quot;</span>);
<a name="l00198"></a>00198                 }
<a name="l00199"></a>00199         }
<a name="l00201"></a>00201         <span class="keywordflow">else</span> {
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 <span class="keywordflow">if</span> ((($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]) == <span class="stringliteral">&quot;&quot;</span>) || (($_POST[<span class="stringliteral">&#39;user_password&#39;</span>]) == <span class="stringliteral">&quot;&quot;</span>)) {
<a name="l00204"></a>00204                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Blank e-mail/password NOT allowed&quot;</span>);
<a name="l00205"></a>00205                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00206"></a>00206                 }
<a name="l00207"></a>00207 
<a name="l00208"></a>00208                 <span class="keywordflow">if</span> ((($_POST[<span class="stringliteral">&#39;user_name&#39;</span>]) == <span class="stringliteral">&quot;&quot;</span>) || (($_POST[<span class="stringliteral">&#39;user_fullname&#39;</span>]) == <span class="stringliteral">&quot;&quot;</span>)) {
<a name="l00209"></a>00209                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Please fill in your user name and Full name&quot;</span>);
<a name="l00210"></a>00210                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00211"></a>00211                 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213                 <span class="keywordflow">if</span> (!eregi(<span class="stringliteral">&quot;^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,3})$&quot;</span>, $_POST[<span class="stringliteral">&#39;user_email&#39;</span>])) {
<a name="l00214"></a>00214                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Invalid Email Id&quot;</span>);
<a name="l00215"></a>00215                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00216"></a>00216                 }
<a name="l00217"></a>00217                 <span class="keywordflow">if</span> (($_POST[<span class="stringliteral">&#39;user_password&#39;</span>]) != ($_POST[<span class="stringliteral">&#39;user_repassword&#39;</span>])) {
<a name="l00218"></a>00218                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Passwords are not same&quot;</span>);
<a name="l00219"></a>00219                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00220"></a>00220                 }
<a name="l00221"></a>00221                 <span class="keywordflow">if</span> (<a class="code" href="registrationformsubmit_8bak_8php.html#a12ab17fb256418f60a3122e8e756fde0">submitCaptcha</a>()==<span class="keyword">false</span>) {
<a name="l00222"></a>00222                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00223"></a>00223                 }
<a name="l00224"></a>00224                 <span class="comment">/*For new registrations*/</span>
<a name="l00225"></a>00225 
<a name="l00226"></a>00226                 $umail = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]);
<a name="l00227"></a>00227                 $umail = trim($umail);
<a name="l00228"></a>00228 
<a name="l00229"></a>00229                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;SELECT * FROM `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` WHERE `user_email`=&#39;&quot;</span> . $umail . <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00230"></a>00230                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>) or <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(mysql_error() . <span class="stringliteral">&quot;in registration L:115&quot;</span>);
<a name="l00231"></a>00231                 <span class="keywordflow">if</span> (mysql_num_rows(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>)) {
<a name="l00232"></a>00232                         <a class="code" href="common_8lib_8php.html#ada25164e4f2df73f68b14e35011c9674">displaywarning</a>(<span class="stringliteral">&quot;Email already exists in database. Please use a different e-mail.&quot;</span>);
<a name="l00233"></a>00233                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00234"></a>00234                 } <span class="keywordflow">else</span> {
<a name="l00235"></a>00235                         $passwd = md5($_POST[<span class="stringliteral">&#39;user_password&#39;</span>]);
<a name="l00236"></a>00236                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;INSERT INTO `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` &quot;</span> .
<a name="l00237"></a>00237                                         <span class="stringliteral">&quot;(`user_name`, `user_email`, `user_fullname`, `user_password`, `user_activated`) &quot;</span> .
<a name="l00238"></a>00238                                         <span class="stringliteral">&quot;VALUES (&#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_name&#39;</span>]).<span class="stringliteral">&quot;&#39;, &#39;&quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]).<span class="stringliteral">&quot;&#39;, &#39;&quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;user_fullname&#39;</span>]).<span class="stringliteral">&quot;&#39;, &#39;$passwd&#39;, &quot;</span>.<a class="code" href="index_8php.html#addda34140bdf76f4e45ff38a1c4659b4" title="Whether to activate the user on registration.">ACTIVATE_USER_ON_REG</a>.<span class="stringliteral">&quot;)&quot;</span>;
<a name="l00239"></a>00239                         <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00240"></a>00240                         $query1 = <span class="stringliteral">&quot;SELECT `user_id` FROM `&quot;</span>. <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` WHERE `user_email` =&#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]).<span class="stringliteral">&quot;&#39; LIMIT 1&quot;</span>;
<a name="l00241"></a>00241                         $result1 = mysql_query($query1);
<a name="l00242"></a>00242                         $result1 = mysql_fetch_array($result1);
<a name="l00243"></a>00243                         $form_result = <a class="code" href="registrationformsubmit_8bak_8php.html#a38e840621952d7270b5248cbbc821f41">submitRegistrationForm</a>(0, $result1[0], <span class="keyword">true</span>, <span class="keyword">true</span>); 
<a name="l00244"></a>00244                         <span class="keywordflow">if</span>(!$form_result)
<a name="l00245"></a>00245                                 {
<a name="l00246"></a>00246                                         $query1 = <span class="stringliteral">&quot;DELETE FROM `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` WHERE `user_id` = &quot;</span>.$result1[0];
<a name="l00247"></a>00247                                         <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query($query1); 
<a name="l00248"></a>00248                                         <span class="keywordflow">return</span> <a class="code" href="registration_8lib_8php.html#a763a988188be5422acc696ab9b6ef5c3">getRegistrationForm</a>();
<a name="l00249"></a>00249                                 }                       
<a name="l00250"></a>00250                         <span class="keywordflow">if</span> (<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>)
<a name="l00251"></a>00251                         {
<a name="l00252"></a>00252                                 <span class="keywordflow">if</span>(<a class="code" href="index_8php.html#addda34140bdf76f4e45ff38a1c4659b4" title="Whether to activate the user on registration.">ACTIVATE_USER_ON_REG</a>)
<a name="l00253"></a>00253                                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;You have been successfully registered. You can now &lt;a href=\&quot;./+login\&quot;&gt;log in&lt;/a&gt;.&quot;</span>);
<a name="l00254"></a>00254                                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;Your registration was successful but your account is not activated yet. Kindly check your email, or wait for the website administrator to activate you.&quot;</span>);
<a name="l00255"></a>00255                         }
<a name="l00256"></a>00256                         <span class="keywordflow">if</span>(<a class="code" href="index_8php.html#aae62d86fb3cee03afa9a3345c2801f3e" title="Whether to send a mail when a new user registers.">SEND_MAIL_ON_REGISTRATION</a>)
<a name="l00257"></a>00257                         {
<a name="l00258"></a>00258                                 $email = $umail;
<a name="l00259"></a>00259                                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;SELECT * FROM  `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users`  WHERE `user_email`=&#39;$email&#39; &quot;</span>;
<a name="l00260"></a>00260                                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>) or <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(mysql_error() . <span class="stringliteral">&quot;registration L:211&quot;</span>);
<a name="l00261"></a>00261                         
<a name="l00262"></a>00262                                 $temp = mysql_fetch_assoc(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00263"></a>00263                                 $key = <a class="code" href="registration_8lib_8php.html#a0168628c340092eabf2c2c4f7b642cf8">getVerificationKey</a>($email, $temp[<span class="stringliteral">&#39;user_password&#39;</span>], $temp[<span class="stringliteral">&#39;user_regdate&#39;</span>]);
<a name="l00264"></a>00264 
<a name="l00265"></a>00265                                 <span class="comment">// send mail code starts here - see common.lib.php for more</span>
<a name="l00266"></a>00266                                 $from = <span class="stringliteral">&quot;from: &quot;</span>.CMS_TITLE.<span class="stringliteral">&quot; &lt;&quot;</span>.<a class="code" href="index_8php.html#ae32bfde794a614f2194100fbea8f0bc1" title="Email address to be used by CMS when sending mails to users.">CMS_EMAIL</a>.<span class="stringliteral">&quot;&gt;&quot;</span>;
<a name="l00267"></a>00267                                 $to = <span class="stringliteral">&quot;$email&quot;</span>;
<a name="l00268"></a>00268                                 $mailtype = <span class="stringliteral">&quot;activation_mail&quot;</span>;
<a name="l00269"></a>00269                 
<a name="l00270"></a>00270                 
<a name="l00271"></a>00271                                 $messenger = <span class="keyword">new</span> <a class="code" href="classmessenger.html">messenger</a>(<span class="keyword">false</span>);
<a name="l00272"></a>00272                                 global <a class="code" href="index_8php.html#a2e4dc0222b3edd3c006d48fd1dcb31e6" title="For example, if hosted on pragyan.org/10, $onlineSiteUrl = http://pragyan.org/10/home.">$onlineSiteUrl</a>;
<a name="l00273"></a>00273                                 $messenger-&gt;assign_vars(array(<span class="stringliteral">&#39;ACTIVATE_URL&#39;</span>=&gt;<span class="stringliteral">&quot;$onlineSiteUrl/+login&amp;subaction=register&amp;verify=$to&amp;key=$key&quot;</span>,<span class="stringliteral">&#39;NAME&#39;</span>=&gt;<span class="stringliteral">&quot;$temp[user_fullname]&quot;</span>,<span class="stringliteral">&#39;WEBSITE&#39;</span>=&gt;<a class="code" href="index_8php.html#a19bfcfd60c7a6722ee3dab8354e6aba1" title="Some of the previously defined global settings variables are converted into constants.">CMS_TITLE</a>, <span class="stringliteral">&#39;DOMAIN&#39;</span>=&gt;$onlineSiteUrl));
<a name="l00274"></a>00274 
<a name="l00275"></a>00275                                 <span class="keywordflow">if</span> ($messenger-&gt;mailer($to,$mailtype,$key,$from))
<a name="l00276"></a>00276                                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;Kindly check your e-mail for activation link.&quot;</span>);
<a name="l00277"></a>00277                                 <span class="keywordflow">else</span> 
<a name="l00278"></a>00278                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Activation link sending failure. Kindly contact administrator&quot;</span>);
<a name="l00279"></a>00279                                 <span class="comment">// send mail code ends here</span>
<a name="l00280"></a>00280                                         
<a name="l00281"></a>00281                         }
<a name="l00282"></a>00282                         
<a name="l00283"></a>00283                 }
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a><a class="code" href="registration_8lib_8php.html#a0168628c340092eabf2c2c4f7b642cf8">00287</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="registration_8lib_8php.html#a0168628c340092eabf2c2c4f7b642cf8">getVerificationKey</a>($userEmail, $userPassword, $userRegistrationTime) {
<a name="l00288"></a>00288         <span class="keywordflow">return</span> md5(substr($userEmail, 0, 6) . substr(md5($userPassword), -17) . $userRegistrationTime . $userPassword);
<a name="l00289"></a>00289 }
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 2 2011 04:55:32 for Pragyan CMS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
