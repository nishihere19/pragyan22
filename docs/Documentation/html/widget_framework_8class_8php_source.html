<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Pragyan CMS: cms/widgetFramework.class.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>cms/widgetFramework.class.php</h1>  </div>
</div>
<div class="contents">
<a href="widget_framework_8class_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;__PRAGYAN_CMS&#39;</span>))
<a name="l00003"></a>00003 { 
<a name="l00004"></a>00004         header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>].<span class="stringliteral">&#39; 403 Forbidden&#39;</span>);
<a name="l00005"></a>00005         echo <span class="stringliteral">&quot;&lt;h1&gt;403 Forbidden&lt;h1&gt;&lt;h4&gt;You are not authorized to access the page.&lt;/h4&gt;&quot;</span>;
<a name="l00006"></a>00006         echo <span class="stringliteral">&#39;&lt;hr/&gt;&#39;</span>.$_SERVER[<span class="stringliteral">&#39;SERVER_SIGNATURE&#39;</span>];
<a name="l00007"></a>00007         exit(1);
<a name="l00008"></a>00008 }
<a name="l00017"></a><a class="code" href="classwidget_framework.html">00017</a> <span class="keyword">abstract</span> <span class="keyword">class </span><a class="code" href="classwidget_framework.html" title="An abstract class that every widget must extend. It contains the implementation of some of the common...">widgetFramework</a>
<a name="l00018"></a>00018 {       
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="classwidget_framework.html#a653927b93ed0274f7f6c090cf9630ab1">00020</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a653927b93ed0274f7f6c090cf9630ab1" title="Name of the widget.">$widgetName</a>; 
<a name="l00021"></a><a class="code" href="classwidget_framework.html#ad78a70a7f7a88a458cda3f72c66f7af7">00021</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#ad78a70a7f7a88a458cda3f72c66f7af7" title="Description of the widget.">$widgetDescription</a>; 
<a name="l00022"></a><a class="code" href="classwidget_framework.html#a4da85c36acdbf31cb7fea83d39a982fd">00022</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a4da85c36acdbf31cb7fea83d39a982fd" title="Version of the widget.">$widgetVersion</a>; 
<a name="l00023"></a><a class="code" href="classwidget_framework.html#a54574a28839156c0489a0d02613dd8a7">00023</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a54574a28839156c0489a0d02613dd8a7" title="Author of the widget.">$widgetAuthor</a>; 
<a name="l00024"></a><a class="code" href="classwidget_framework.html#a275d3731e9858e1f70b03349579ee9f2">00024</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a275d3731e9858e1f70b03349579ee9f2" title="Id of the widget.">$widgetId</a>; 
<a name="l00025"></a><a class="code" href="classwidget_framework.html#afe19b20882d0f29c30f573295f30a5df">00025</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#afe19b20882d0f29c30f573295f30a5df" title="Instance Id of the widget.">$widgetInstanceId</a>; 
<a name="l00026"></a><a class="code" href="classwidget_framework.html#a3c69b8c78bc1296ebb168fcb919e256f">00026</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a3c69b8c78bc1296ebb168fcb919e256f" title="Page Id of the page this instance is located on.">$widgetPageId</a>; 
<a name="l00027"></a><a class="code" href="classwidget_framework.html#a0c3ff6b1bb7b8ddf02e2c00fb901f9ff">00027</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a0c3ff6b1bb7b8ddf02e2c00fb901f9ff" title="Location of the widget on the page.">$widgetLocation</a>; 
<a name="l00028"></a><a class="code" href="classwidget_framework.html#a9b4c5ab833f21e4bcc0d6e876d1b8120">00028</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a9b4c5ab833f21e4bcc0d6e876d1b8120" title="Order of the widget, in case when multiple widgets are on the same location.">$widgetOrder</a>; 
<a name="l00029"></a><a class="code" href="classwidget_framework.html#ac7c3353107070daa85f641882931b358">00029</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#ac7c3353107070daa85f641882931b358" title="Instance-Specific Settings of the widget in key=&amp;gt;value format.">$settings</a>; 
<a name="l00030"></a><a class="code" href="classwidget_framework.html#a6efc15b5a2314dd4b5aaa556a375c6d6">00030</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a6efc15b5a2314dd4b5aaa556a375c6d6" title="A sort of RAM or heap store for the widget in key=&amp;gt;value format.">$data</a>; 
<a name="l00031"></a><a class="code" href="classwidget_framework.html#a8caaf4e63446b45370067287c902dead">00031</a>         <span class="keyword">public</span> <a class="code" href="classwidget_framework.html#a8caaf4e63446b45370067287c902dead" title="Default configurations of the widget.">$defaultConfigs</a>; 
<a name="l00032"></a>00032         
<a name="l00033"></a>00033         
<a name="l00035"></a>00035         <span class="keyword">abstract</span> <span class="keyword">public</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#a06d4854192dc5667780e5ac2f435e133" title="For widget initialization.">initWidget</a>();
<a name="l00036"></a>00036         
<a name="l00038"></a>00038         <span class="keyword">abstract</span> <span class="keyword">public</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#a5fc878ede54118176f912b557031ddd6" title="For retrieving the widget output.">getHTML</a>();
<a name="l00039"></a>00039         
<a name="l00041"></a>00041         <span class="keyword">abstract</span> <span class="keyword">public</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#a49306a10df04d907bef532cfdafd1583" title="For retrieving the widget output which is common for all instances of same widget.">getCommonHTML</a>();
<a name="l00042"></a>00042         
<a name="l00050"></a><a class="code" href="classwidget_framework.html#aa27b105c8adecd58229ab748cb903059">00050</a>         <span class="keyword">public</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#aa27b105c8adecd58229ab748cb903059">__construct</a>(<a class="code" href="classwidget_framework.html#a275d3731e9858e1f70b03349579ee9f2" title="Id of the widget.">$widgetId</a>,<a class="code" href="classwidget_framework.html#afe19b20882d0f29c30f573295f30a5df" title="Instance Id of the widget.">$widgetInstanceId</a>,<a class="code" href="cms_2templates_2nitt09_2index_8php.html#ac4afd2d667420bf8ad7d5c59347669c3">$pageId</a>,$defaultconfigs)
<a name="l00051"></a>00051         {
<a name="l00052"></a>00052                 $this-&gt;widgetId=<a class="code" href="classwidget_framework.html#a275d3731e9858e1f70b03349579ee9f2" title="Id of the widget.">$widgetId</a>;
<a name="l00053"></a>00053                 $this-&gt;widgetInstanceId=<a class="code" href="classwidget_framework.html#afe19b20882d0f29c30f573295f30a5df" title="Instance Id of the widget.">$widgetInstanceId</a>;
<a name="l00054"></a>00054                 $this-&gt;pageId=<a class="code" href="cms_2templates_2nitt09_2index_8php.html#ac4afd2d667420bf8ad7d5c59347669c3">$pageId</a>;
<a name="l00055"></a>00055                 $this-&gt;defaultConfigs=$defaultconfigs;
<a name="l00056"></a>00056                 $this-&gt;<a class="code" href="classwidget_framework.html#ab5747e25b55159c548efffa283442d13">loadWidget</a>();
<a name="l00057"></a>00057                 
<a name="l00058"></a>00058                 
<a name="l00059"></a>00059         } 
<a name="l00060"></a>00060         
<a name="l00067"></a><a class="code" href="classwidget_framework.html#ab5747e25b55159c548efffa283442d13">00067</a>         <span class="keyword">public</span> <span class="keyword">final</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#ab5747e25b55159c548efffa283442d13">loadWidget</a>()
<a name="l00068"></a>00068         {
<a name="l00069"></a>00069         
<a name="l00071"></a>00071                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT `widget_name` AS &#39;name&#39;, `widget_description` AS &#39;description&#39;, `widget_version` AS &#39;version&#39;, `widget_author` AS &#39;author&#39; FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsinfo` WHERE `widget_id`={$this-&gt;widgetId}&quot;</span>;
<a name="l00072"></a>00072                 $res=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00073"></a>00073                 <span class="keywordflow">if</span>($res===<span class="keyword">false</span> || mysql_num_rows($res)==0)
<a name="l00074"></a>00074                 {
<a name="l00075"></a>00075                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in loading widget {$this-&gt;widgetName}&quot;</span>);
<a name="l00076"></a>00076                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00077"></a>00077                 }
<a name="l00078"></a>00078                 $row=mysql_fetch_array($res);
<a name="l00079"></a>00079                 
<a name="l00080"></a>00080                 $this-&gt;widgetName=$row[<span class="stringliteral">&#39;name&#39;</span>];
<a name="l00081"></a>00081                 $this-&gt;widgetDescription=$row[<span class="stringliteral">&#39;description&#39;</span>];
<a name="l00082"></a>00082                 $this-&gt;widgetVersion=$row[<span class="stringliteral">&#39;version&#39;</span>];
<a name="l00083"></a>00083                 $this-&gt;widgetAuthor=$row[<span class="stringliteral">&#39;author&#39;</span>];
<a name="l00084"></a>00084                 
<a name="l00086"></a>00086                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT `config_name` AS &#39;key&#39;, `config_value` AS &#39;value&#39; FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsconfig` WHERE `widget_id`={$this-&gt;widgetId} AND `widget_instanceid` IN ({$this-&gt;widgetInstanceId},-1) &quot;</span>;
<a name="l00087"></a>00087                 $res=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00088"></a>00088                 
<a name="l00089"></a>00089                 <span class="keywordflow">if</span>($res===<span class="keyword">false</span>)
<a name="l00090"></a>00090                 {
<a name="l00091"></a>00091                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in loading widget {$this-&gt;widgetName}&quot;</span>);
<a name="l00092"></a>00092                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00093"></a>00093                 }
<a name="l00094"></a>00094                 $this-&gt;settings = array();
<a name="l00095"></a>00095                 <span class="keywordflow">while</span>($row=mysql_fetch_array($res))
<a name="l00096"></a>00096                 {
<a name="l00097"></a>00097                         $this-&gt;settings[$row[<span class="stringliteral">&#39;key&#39;</span>]]=$row[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00098"></a>00098                 }
<a name="l00099"></a>00099                 
<a name="l00101"></a>00101                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT `config_name` AS &#39;key&#39;, `config_default` AS &#39;value&#39;, `is_global` AS &#39;global&#39; FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsconfiginfo` WHERE `widget_id`={$this-&gt;widgetId}&quot;</span>;
<a name="l00102"></a>00102                 
<a name="l00103"></a>00103                 $res=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00104"></a>00104                 <span class="keywordflow">if</span>($res===<span class="keyword">false</span>)
<a name="l00105"></a>00105                 {
<a name="l00106"></a>00106                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in loading widget {$this-&gt;widgetName}&quot;</span>);
<a name="l00107"></a>00107                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00108"></a>00108                 }
<a name="l00109"></a>00109                 
<a name="l00110"></a>00110                 <span class="keywordflow">while</span>($row=mysql_fetch_array($res))
<a name="l00111"></a>00111                 {
<a name="l00112"></a>00112                         <span class="keywordflow">if</span>(!isset($this-&gt;settings[$row[<span class="stringliteral">&#39;key&#39;</span>]]))
<a name="l00113"></a>00113                         {
<a name="l00114"></a>00114                                 $this-&gt;settings[$row[<span class="stringliteral">&#39;key&#39;</span>]]=$row[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00115"></a>00115                                 
<a name="l00117"></a>00117                                 <span class="keywordflow">if</span>(($row[<span class="stringliteral">&#39;global&#39;</span>]==<span class="charliteral">&#39;1&#39;</span> &amp;&amp; $this-&gt;widgetInstanceId==-1) || ($row[<span class="stringliteral">&#39;global&#39;</span>]==<span class="charliteral">&#39;0&#39;</span> &amp;&amp; $this-&gt;widgetInstanceId!=-1))
<a name="l00118"></a>00118                                 {
<a name="l00119"></a>00119                                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;INSERT IGNORE INTO `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsconfig` (`widget_id`,`widget_instanceid`,`config_name`,`config_value`) VALUES ({$this-&gt;widgetId}, {$this-&gt;widgetInstanceId}, &#39;{$row[&#39;key&#39;]}&#39;, &#39;{$row[&#39;value&#39;]}&#39;)&quot;</span>;
<a name="l00120"></a>00120                                         $res2=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00121"></a>00121                                         <span class="keywordflow">if</span>($res2===<span class="keyword">false</span>)
<a name="l00122"></a>00122                                         {
<a name="l00123"></a>00123                                                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in loading widget {$this-&gt;widgetName}&quot;</span>);
<a name="l00124"></a>00124                                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00125"></a>00125                                         }
<a name="l00126"></a>00126                                 }
<a name="l00127"></a>00127                         }
<a name="l00128"></a>00128                 }
<a name="l00129"></a>00129         
<a name="l00131"></a>00131                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT `widget_datakey` AS &#39;key&#39;, `widget_datavalue` AS &#39;value&#39; FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsdata` WHERE `widget_id`={$this-&gt;widgetId} AND`widget_instanceid` = {$this-&gt;widgetInstanceId}&quot;</span>;
<a name="l00132"></a>00132                 $res=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00133"></a>00133                 <span class="keywordflow">if</span>($res===<span class="keyword">false</span>)
<a name="l00134"></a>00134                 {
<a name="l00135"></a>00135                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in loading widget {$this-&gt;widgetName}&quot;</span>);
<a name="l00136"></a>00136                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00137"></a>00137                 }
<a name="l00138"></a>00138                 $this-&gt;data = array();
<a name="l00139"></a>00139                 <span class="keywordflow">while</span>($row=mysql_fetch_array($res))
<a name="l00140"></a>00140                 {
<a name="l00141"></a>00141                         $this-&gt;data[$row[<span class="stringliteral">&#39;key&#39;</span>]]=$row[<span class="stringliteral">&#39;value&#39;</span>];
<a name="l00142"></a>00142                 }
<a name="l00143"></a>00143                 
<a name="l00144"></a>00144                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00145"></a>00145                 
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147         
<a name="l00154"></a><a class="code" href="classwidget_framework.html#afef898d748178772abe5788fbcacf577">00154</a>         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#afef898d748178772abe5788fbcacf577">validInstall</a>()
<a name="l00155"></a>00155         {
<a name="l00156"></a>00156                 <span class="keywordflow">if</span>(!isset($this-&gt;data[<span class="stringliteral">&#39;pragyan_widget_install&#39;</span>]) || isset($this-&gt;data[<span class="stringliteral">&#39;pragyan_widget_install&#39;</span>])==0)
<a name="l00157"></a>00157                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00158"></a>00158                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00159"></a>00159         }
<a name="l00160"></a>00160         
<a name="l00165"></a><a class="code" href="classwidget_framework.html#a1d40cdd6834bc79f6cfe555c07edd6f2">00165</a>         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#a1d40cdd6834bc79f6cfe555c07edd6f2">installWidget</a>()
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167                 
<a name="l00169"></a>00169                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;DELETE FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsconfiginfo` WHERE `widget_id`={$this-&gt;widgetId}&quot;</span>;
<a name="l00170"></a>00170                 mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00171"></a>00171                 
<a name="l00172"></a>00172                 
<a name="l00173"></a>00173                 $install=$this-&gt;<a class="code" href="classwidget_framework.html#aa21c43fd161b663c9b10fee2ec1e3b26">setConfigs</a>($this-&gt;defaultConfigs);
<a name="l00174"></a>00174                 <span class="keywordflow">if</span>($install==<span class="keyword">true</span>)
<a name="l00175"></a>00175                 {
<a name="l00176"></a>00176                         <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;{$this-&gt;widgetName} widget successfully installed!&quot;</span>);
<a name="l00177"></a>00177                         <span class="keywordflow">return</span> $this-&gt;<a class="code" href="classwidget_framework.html#aef60ea36d021abf93adfa7c9c12a9cbc">saveData</a>(<span class="stringliteral">&#39;pragyan_widget_install&#39;</span>,<span class="charliteral">&#39;1&#39;</span>);
<a name="l00178"></a>00178                 }
<a name="l00179"></a>00179                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00180"></a>00180         }
<a name="l00181"></a>00181         
<a name="l00187"></a><a class="code" href="classwidget_framework.html#aa21c43fd161b663c9b10fee2ec1e3b26">00187</a>         <span class="keyword">public</span> <span class="keyword">final</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#aa21c43fd161b663c9b10fee2ec1e3b26">setConfigs</a>($configs)
<a name="l00188"></a>00188         {
<a name="l00189"></a>00189                 $rank=0;
<a name="l00190"></a>00190                 <span class="keywordflow">foreach</span>($configs as $config)
<a name="l00191"></a>00191                 {
<a name="l00192"></a>00192                         $config[<span class="stringliteral">&#39;global&#39;</span>]=(int)$config[<span class="stringliteral">&#39;global&#39;</span>];
<a name="l00193"></a>00193                         
<a name="l00194"></a>00194                         <span class="keywordflow">foreach</span>($config as $key=&gt;$value) $config[$key]=<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($value);
<a name="l00195"></a>00195                         
<a name="l00196"></a>00196                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;INSERT IGNORE INTO `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsconfiginfo` (`widget_id`,`config_name`,`config_type`,`config_options`,`config_displaytext`,`config_default`,`is_global`,`config_rank`) VALUES ({$this-&gt;widgetId},&#39;{$config[&#39;name&#39;]}&#39;,&#39;{$config[&#39;type&#39;]}&#39;,&#39;{$config[&#39;options&#39;]}&#39;,&#39;{$config[&#39;displaytext&#39;]}&#39;,&#39;{$config[&#39;default&#39;]}&#39;,{$config[&#39;global&#39;]},{$rank})&quot;</span>;
<a name="l00197"></a>00197                         
<a name="l00198"></a>00198                         $rank++;
<a name="l00199"></a>00199                         <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>)==<span class="keyword">false</span>)
<a name="l00200"></a>00200                         {
<a name="l00201"></a>00201                                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in saving configurations for the widget {$this-&gt;widgetName}&quot;</span>);
<a name="l00202"></a>00202                                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00203"></a>00203                         }
<a name="l00204"></a>00204                 }
<a name="l00205"></a>00205                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207         
<a name="l00214"></a><a class="code" href="classwidget_framework.html#a5090682f1df5900c690d74f4043e768b">00214</a>         <span class="keyword">public</span> <span class="keyword">final</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#a5090682f1df5900c690d74f4043e768b">saveSetting</a>($key,$value)
<a name="l00215"></a>00215         {
<a name="l00216"></a>00216                 $value = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($value);
<a name="l00217"></a>00217                 $key = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($key);
<a name="l00218"></a>00218                 
<a name="l00219"></a>00219                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;UPDATE `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsconfig` SET `config_value`=&#39;$value&#39; WHERE `config_name`=&#39;$key&#39; AND `widget_id`={$this-&gt;widgetId} AND `widget_instanceid`={$this-&gt;widgetInstanceId}&quot;</span>;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>)===<span class="keyword">false</span>) {
<a name="l00222"></a>00222                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in saving setting for the widget {$this-&gt;widgetName}.&quot;</span>);
<a name="l00223"></a>00223                         <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l00224"></a>00224                 }
<a name="l00225"></a>00225                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00226"></a>00226                 
<a name="l00227"></a>00227         }
<a name="l00228"></a>00228         
<a name="l00235"></a><a class="code" href="classwidget_framework.html#aef60ea36d021abf93adfa7c9c12a9cbc">00235</a>         <span class="keyword">public</span> <span class="keyword">final</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#aef60ea36d021abf93adfa7c9c12a9cbc">saveData</a>($key,$value)
<a name="l00236"></a>00236         {
<a name="l00237"></a>00237                 $value = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($value);
<a name="l00238"></a>00238                 $key = <a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($key);
<a name="l00239"></a>00239                 
<a name="l00240"></a>00240                 <span class="keywordflow">if</span>(isset($this-&gt;data[$key]))
<a name="l00241"></a>00241                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;UPDATE `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsdata` SET `widget_datavalue`=&#39;$value&#39; WHERE `widget_datakey`=&#39;$key&#39; AND `widget_id`={$this-&gt;widgetId} AND `widget_instanceid`={$this-&gt;widgetInstanceId}&quot;</span>;
<a name="l00242"></a>00242                 <span class="keywordflow">else</span> 
<a name="l00243"></a>00243                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;INSERT INTO `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgetsdata` (`widget_id`,`widget_instanceid`,`widget_datakey`,`widget_datavalue`) VALUES ({$this-&gt;widgetId},{$this-&gt;widgetInstanceId},&#39;$key&#39;,&#39;$value&#39;)&quot;</span>;
<a name="l00244"></a>00244                 
<a name="l00245"></a>00245                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>)===<span class="keyword">false</span>)
<a name="l00246"></a>00246                 {
<a name="l00247"></a>00247                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Error in saving data for the widget {$this-&gt;widgetName}.&quot;</span>);
<a name="l00248"></a>00248                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00249"></a>00249                 }
<a name="l00250"></a>00250                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252         
<a name="l00262"></a><a class="code" href="classwidget_framework.html#a1f35c7c58fe6ce91a53770a82d16cb7a">00262</a>         <span class="keyword">public</span> <span class="keyword">final</span> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="classwidget_framework.html#a1f35c7c58fe6ce91a53770a82d16cb7a">createWidget</a>(<a class="code" href="cms_2templates_2nitt09_2index_8php.html#ac4afd2d667420bf8ad7d5c59347669c3">$pageId</a>,&amp;<a class="code" href="classwidget_framework.html#a0c3ff6b1bb7b8ddf02e2c00fb901f9ff" title="Location of the widget on the page.">$widgetLocation</a>,&amp;<a class="code" href="classwidget_framework.html#a9b4c5ab833f21e4bcc0d6e876d1b8120" title="Order of the widget, in case when multiple widgets are on the same location.">$widgetOrder</a>)
<a name="l00263"></a>00263         {
<a name="l00265"></a>00265                 $defaultloc=1;
<a name="l00266"></a>00266                 
<a name="l00267"></a>00267                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT MAX(`widget_instanceid`) FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgets` WHERE `widget_id` = {$this-&gt;widgetId}&quot;</span>;
<a name="l00268"></a>00268                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00269"></a>00269                 <span class="keywordflow">if</span>(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>===<span class="keyword">false</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00270"></a>00270                 $row1=mysql_fetch_row(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00271"></a>00271                 <span class="keywordflow">if</span>($row1==NULL)
<a name="l00272"></a>00272                  $row1[0]=0;
<a name="l00273"></a>00273                 
<a name="l00274"></a>00274                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT MAX(`widget_order`) FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgets` WHERE `page_id` = $pageId AND `widget_location` = $defaultloc&quot;</span>;
<a name="l00275"></a>00275                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00276"></a>00276                 <span class="keywordflow">if</span>(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>===<span class="keyword">false</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00277"></a>00277                 $row2=mysql_fetch_array(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00278"></a>00278                 <span class="keywordflow">if</span>($row2==NULL)
<a name="l00279"></a>00279                  $row2[0]=0;
<a name="l00280"></a>00280                 
<a name="l00281"></a>00281                 $instanceId=$row1[0]+1; 
<a name="l00282"></a>00282                 <a class="code" href="classwidget_framework.html#a9b4c5ab833f21e4bcc0d6e876d1b8120" title="Order of the widget, in case when multiple widgets are on the same location.">$widgetOrder</a>=$row2[0]+1;
<a name="l00283"></a>00283                 <a class="code" href="classwidget_framework.html#a0c3ff6b1bb7b8ddf02e2c00fb901f9ff" title="Location of the widget on the page.">$widgetLocation</a>=$defaultloc; 
<a name="l00284"></a>00284                 
<a name="l00285"></a>00285                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;INSERT INTO `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;widgets` (`widget_id`,`widget_instanceid`,`page_id`,`widget_location`,`widget_order`) VALUES ({$this-&gt;widgetId},$instanceId,$pageId,$widgetLocation,$widgetOrder)&quot;</span>;
<a name="l00286"></a>00286                 
<a name="l00287"></a>00287                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>)==<span class="keyword">false</span>)
<a name="l00288"></a>00288                         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00289"></a>00289                 
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291         
<a name="l00292"></a>00292         
<a name="l00293"></a>00293 }        
<a name="l00294"></a>00294 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 2 2011 04:55:32 for Pragyan CMS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
