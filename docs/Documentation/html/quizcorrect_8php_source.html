<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Pragyan CMS: cms/modules/quiz/quizcorrect.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>cms/modules/quiz/quizcorrect.php</h1>  </div>
</div>
<div class="contents">
<a href="quizcorrect_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;__PRAGYAN_CMS&#39;</span>))
<a name="l00003"></a>00003 { 
<a name="l00004"></a>00004         header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>].<span class="stringliteral">&#39; 403 Forbidden&#39;</span>);
<a name="l00005"></a>00005         echo <span class="stringliteral">&quot;&lt;h1&gt;403 Forbidden&lt;h1&gt;&lt;h4&gt;You are not authorized to access the page.&lt;/h4&gt;&quot;</span>;
<a name="l00006"></a>00006         echo <span class="stringliteral">&#39;&lt;hr/&gt;&#39;</span>.$_SERVER[<span class="stringliteral">&#39;SERVER_SIGNATURE&#39;</span>];
<a name="l00007"></a>00007         exit(1);
<a name="l00008"></a>00008 }
<a name="l00009"></a>00009 <span class="comment">/*</span>
<a name="l00010"></a>00010 <span class="comment"> * Created on Jan 23, 2009</span>
<a name="l00011"></a>00011 <span class="comment"> */</span>
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="quizcorrect_8php.html#a7d2f8d6a60b942b93f01da0034054977">00013</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="quizcorrect_8php.html#a7d2f8d6a60b942b93f01da0034054977">isQuizEvaluated</a>($quizId) {
<a name="l00014"></a>00014         $countQuery = <span class="stringliteral">&quot;SELECT COUNT(*) FROM `quiz_userattempts` WHERE `quiz_marksallotted` IS NULL AND `page_modulecomponentid` = $quizId&quot;</span>;
<a name="l00015"></a>00015         $countResult = mysql_query($countQuery);
<a name="l00016"></a>00016         $countRow = mysql_fetch_row($countResult);
<a name="l00017"></a>00017         <span class="keywordflow">return</span> $countRow[0] == 0;
<a name="l00018"></a>00018 }
<a name="l00019"></a>00019 
<a name="l00024"></a><a class="code" href="quizcorrect_8php.html#a7c37dd5642781843e20e9e5179c29d8f">00024</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="quizcorrect_8php.html#a7c37dd5642781843e20e9e5179c29d8f">evaluateQuiz</a>($quizId) {
<a name="l00025"></a>00025         $updateQuery = &lt;&lt;&lt;UPDATEQUERY
<a name="l00026"></a>00026                 UPDATE `quiz_answersubmissions` SET `quiz_marksallotted` = (
<a name="l00027"></a>00027                         SELECT 
<a name="l00028"></a>00028                                 IF(`quiz_submittedanswer` IS NULL OR `quiz_submittedanswer` = <span class="stringliteral">&#39;&#39;</span>, 0, 
<a name="l00029"></a>00029                                         IF(`ques`.`quiz_questiontype` = <span class="stringliteral">&#39;subjective&#39;</span>, `quiz_answersubmissions`.`quiz_marksallotted`, 
<a name="l00030"></a>00030                                                 IF(`quiz_submittedanswer` = `quiz_rightanswer`, `question_positivemarks`, -`question_negativemarks`)
<a name="l00031"></a>00031                                         )
<a name="l00032"></a>00032                                 ) AS `mark`
<a name="l00033"></a>00033                         FROM `quiz_questions` AS `ques`, (SELECT * FROM `quiz_answersubmissions`) AS `ans`, `quiz_weightmarks` AS `weights`
<a name="l00034"></a>00034                         WHERE
<a name="l00035"></a>00035                                 `ques`.`page_modulecomponentid` = $quizId AND
<a name="l00036"></a>00036                                 `ans`.`page_modulecomponentid` = $quizId AND
<a name="l00037"></a>00037                                 `weights`.`page_modulecomponentid` = $quizId AND
<a name="l00038"></a>00038                                 `weights`.`question_weight` = `ques`.`quiz_questionweight` AND
<a name="l00039"></a>00039                                 `ques`.`quiz_sectionid` = `ans`.`quiz_sectionid` AND 
<a name="l00040"></a>00040                                 `ques`.`quiz_questionid` = `ans`.`quiz_questionid` AND 
<a name="l00041"></a>00041                                 `ques`.`quiz_questiontype` IN (<span class="stringliteral">&#39;sso&#39;</span>, <span class="stringliteral">&#39;mso&#39;</span>) AND
<a name="l00042"></a>00042                                 `ques`.`quiz_sectionid` = `quiz_answersubmissions`.`quiz_sectionid` AND 
<a name="l00043"></a>00043                                 `ques`.`quiz_questionid` = `quiz_answersubmissions`.`quiz_questionid` AND
<a name="l00044"></a>00044                                 `ans`.`user_id` = `quiz_answersubmissions`.`user_id`
<a name="l00045"></a>00045                 )
<a name="l00046"></a>00046                 WHERE `page_modulecomponentid` = $quizId
<a name="l00047"></a>00047 UPDATEQUERY;
<a name="l00048"></a>00048 <span class="comment">//      echo $updateQuery;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050         $updateResult = mysql_query($updateQuery);
<a name="l00051"></a>00051         <span class="keywordflow">if</span> (!$updateResult) {
<a name="l00052"></a>00052                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&#39;Database Error. Could not correct questions.&#39;</span>);
<a name="l00053"></a>00053                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00054"></a>00054         }
<a name="l00055"></a>00055         
<a name="l00056"></a>00056         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00057"></a>00057 }
<a name="l00062"></a><a class="code" href="quizcorrect_8php.html#a344a08014b490c99fdd3a824fd888430">00062</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="quizcorrect_8php.html#a344a08014b490c99fdd3a824fd888430">updateSectionMarks</a>($quizId) {
<a name="l00063"></a>00063         $updateQuery = <span class="stringliteral">&quot;UPDATE `quiz_userattempts` SET `quiz_marksallotted` = (&quot;</span> .
<a name="l00064"></a>00064                         <span class="stringliteral">&quot;SELECT SUM(`quiz_marksallotted`) FROM `quiz_answersubmissions` WHERE &quot;</span> .
<a name="l00065"></a>00065                         <span class="stringliteral">&quot;`quiz_answersubmissions`.`user_id` = `quiz_userattempts`.`user_id` AND &quot;</span> .
<a name="l00066"></a>00066                         <span class="stringliteral">&quot;`quiz_answersubmissions`.`quiz_sectionid` = `quiz_userattempts`.`quiz_sectionid` AND &quot;</span> .
<a name="l00067"></a>00067                         <span class="stringliteral">&quot;`quiz_answersubmissions`.`page_modulecomponentid` = $quizId&quot;</span> .
<a name="l00068"></a>00068                         <span class="stringliteral">&quot;) WHERE `page_modulecomponentid` = $quizId&quot;</span>;
<a name="l00069"></a>00069         $updateResult = mysql_query($updateQuery);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071         <span class="keywordflow">if</span> (!$updateResult) {
<a name="l00072"></a>00072                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&#39;Database Error. Could not update section marks. &#39;</span> . $updateQuery . <span class="charliteral">&#39; &#39;</span> . mysql_error());
<a name="l00073"></a>00073                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00074"></a>00074         }
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a><a class="code" href="quizcorrect_8php.html#afcccee71190afa8204f62afbd78bbd0e">00079</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="quizcorrect_8php.html#afcccee71190afa8204f62afbd78bbd0e">getWeights</a>($quizId) {
<a name="l00080"></a>00080         $weighs = array();
<a name="l00081"></a>00081         <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<span class="stringliteral">&quot;SELECT `quiz_questionweight` FROM `quiz_questions` WHERE `page_modulecomponentid` = $quizId AND `quiz_questionweight` NOT IN (SELECT `question_weight` FROM `quiz_weightmarks` WHERE `page_modulecomponentid` = $quizId)&quot;</span>);
<a name="l00082"></a>00082         <span class="keywordflow">while</span>($row = mysql_fetch_assoc(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>))
<a name="l00083"></a>00083                 $weighs[] = $row[<span class="stringliteral">&#39;quiz_questionweight&#39;</span>];
<a name="l00084"></a>00084         <span class="keywordflow">return</span> $weighs;
<a name="l00085"></a>00085 }
<a name="l00086"></a>00086 
<a name="l00087"></a><a class="code" href="quizcorrect_8php.html#a80b8b7a2e7957e7053ff3c59740d1aca">00087</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="quizcorrect_8php.html#a80b8b7a2e7957e7053ff3c59740d1aca">getQuizUserListHtml</a>($quizId) {
<a name="l00088"></a>00088         <span class="comment">// Evaluate the quiz,</span>
<a name="l00089"></a>00089         <span class="comment">// retrieve list of users and their total marks, and display</span>
<a name="l00090"></a>00090         $quizRow = <a class="code" href="quizedit_8php.html#a6ada0f11ace918713dcac4ea90d7c6fd">getQuizRow</a>($quizId);
<a name="l00091"></a>00091         $weights = <a class="code" href="quizcorrect_8php.html#afcccee71190afa8204f62afbd78bbd0e">getWeights</a>($quizId);
<a name="l00092"></a>00092         
<a name="l00093"></a>00093         <span class="keywordflow">if</span>(count($weights) &gt; 0) {
<a name="l00094"></a>00094                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Marks for questions with weight &quot;</span> . join(<span class="stringliteral">&quot;, &quot;</span>, $weights) . <span class="stringliteral">&quot; is not set. Correct the quiz after setting marks for all weigh. You can set that in &lt;a href=&#39;./+edit#quizWeightMarks&#39;&gt;Edit&lt;/a&gt;.&quot;</span>);
<a name="l00095"></a>00095                 <span class="keywordflow">return</span> <span class="stringliteral">&#39;&#39;</span>;
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keywordflow">if</span> (!<a class="code" href="quizcorrect_8php.html#a7d2f8d6a60b942b93f01da0034054977">isQuizEvaluated</a>($quizId)||isset($_POST[<span class="stringliteral">&#39;btnRecalculateMarks&#39;</span>]))
<a name="l00099"></a>00099                 <a class="code" href="quizcorrect_8php.html#a7c37dd5642781843e20e9e5179c29d8f">evaluateQuiz</a>($quizId);
<a name="l00100"></a>00100         <a class="code" href="quizcorrect_8php.html#a344a08014b490c99fdd3a824fd888430">updateSectionMarks</a>($quizId);
<a name="l00101"></a>00101         $tableJqueryStuff=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00102"></a>00102         $numSecColumns=0;
<a name="l00103"></a>00103         $userTable = <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&#39;users&#39;</span>;
<a name="l00104"></a>00104         $markQuery = <span class="stringliteral">&quot;SELECT `$userTable`.`user_email` AS `email`, `$userTable`.`user_id` AS `user_id`, SUM(`quiz_marksallotted`) AS `total`, MIN(`quiz_attemptstarttime`) AS `starttime`, MAX(`quiz_submissiontime`) AS `finishtime`, TIMEDIFF(MAX(`quiz_submissiontime`), MIN(`quiz_attemptstarttime`)) AS `timetaken` FROM `$userTable`, `quiz_userattempts` WHERE &quot;</span> .
<a name="l00105"></a>00105                         <span class="stringliteral">&quot;`$userTable`.`user_id` = `quiz_userattempts`.`user_id` AND &quot;</span> .
<a name="l00106"></a>00106                         <span class="stringliteral">&quot;`quiz_userattempts`.`page_modulecomponentid` = $quizId &quot;</span> .
<a name="l00107"></a>00107                         <span class="stringliteral">&quot;GROUP BY `quiz_userattempts`.`user_id` ORDER BY `total` DESC, `timetaken`, `starttime`, `finishtime`, `email`&quot;</span>;
<a name="l00108"></a>00108         $markResult = mysql_query($markQuery);
<a name="l00109"></a>00109         <span class="keywordflow">if</span> (!$markResult) {
<a name="l00110"></a>00110                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>($markQuery . <span class="stringliteral">&#39;  &#39;</span> . mysql_error());
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = mysql_fetch_array(mysql_query(<span class="stringliteral">&quot;SELECT `quiz_title` FROM `quiz_descriptions` WHERE `page_modulecomponentid` = $quizId&quot;</span>));
<a name="l00113"></a>00113         <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<span class="stringliteral">&quot;SELECT `quiz_sectiontitle` FROM `quiz_sections` WHERE `page_modulecomponentid` = &#39;$quizId&#39; ORDER BY `quiz_sectionid`&quot;</span>);
<a name="l00114"></a>00114         $sectionHead = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00115"></a>00115         $secCols=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00116"></a>00116         $toggleColumns=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide(0);&#39; checked /&gt;User Full Name&lt;br/&gt;&lt;/td&gt;&quot;</span>;
<a name="l00117"></a>00117         $toggleColumns.=<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide(1);&#39; /&gt;User Email&lt;br/&gt;&lt;/td&gt;&quot;</span>;
<a name="l00118"></a>00118         $toggleColumns.=<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide(2);&#39; checked /&gt;Marks&lt;br/&gt;&lt;/td&gt;&quot;</span>;
<a name="l00119"></a>00119         $toggleColumns.=<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide(3);&#39; checked /&gt;Time Taken&lt;br/&gt;&lt;/td&gt;&quot;</span>;
<a name="l00120"></a>00120         $toggleColumns.=<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide(4);&#39; /&gt;Started&lt;br/&gt;&lt;/td&gt;&quot;</span>;
<a name="l00121"></a>00121         $toggleColumns.=<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide(5);&#39; /&gt;Finished&lt;br/&gt;&lt;/td&gt;&quot;</span>;
<a name="l00122"></a>00122         
<a name="l00123"></a>00123         $c=6;
<a name="l00124"></a>00124         <span class="keywordflow">while</span>($row = mysql_fetch_array(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>))
<a name="l00125"></a>00125         {
<a name="l00126"></a>00126                 $sectionHead .= <span class="stringliteral">&quot;&lt;th&gt;Section : {$row[&#39;quiz_sectiontitle&#39;]}&lt;/th&gt;&quot;</span>;
<a name="l00127"></a>00127                 $tableJqueryStuff.=<span class="stringliteral">&quot;null,&quot;</span>;
<a name="l00128"></a>00128                 <span class="keywordflow">if</span>($c%6==0) $secCols.=<span class="stringliteral">&quot;&lt;/tr&gt;&lt;tr&gt;&quot;</span>;
<a name="l00129"></a>00129                 $secCols.=<span class="stringliteral">&quot;&lt;td&gt;&lt;input type=&#39;checkbox&#39; onclick=&#39;fnShowHide($c);&#39; checked /&gt;Section : {$row[&#39;quiz_sectiontitle&#39;]}&lt;br/&gt;&lt;/td&gt;&quot;</span>;             
<a name="l00130"></a>00130                 $numSecColumns++;
<a name="l00131"></a>00131                 $c++;
<a name="l00132"></a>00132         }
<a name="l00133"></a>00133         $secCols.=<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00134"></a>00134         $toggleColumns.=$secCols;
<a name="l00135"></a>00135         global <a class="code" href="icons_8lib_8php.html#aedb76478d4528f9a7238cb660ba23f41">$urlRequestRoot</a>, <a class="code" href="icons_8lib_8php.html#a0fa2c9191ec4f6bb08bd885031af226c">$cmsFolder</a>, <a class="code" href="index_8php.html#a3fbe1358b48457ae3788922694d20ea2" title="Will contain a string containing all that has to be executed on window load.">$STARTSCRIPTS</a>;
<a name="l00136"></a>00136         
<a name="l00137"></a>00137         $tableJqueryStuff=&lt;&lt;&lt;STUFF
<a name="l00138"></a>00138                                                         null,
<a name="l00139"></a>00139                                                         { <span class="stringliteral">&quot;bVisible&quot;</span>: <span class="keyword">false</span> },
<a name="l00140"></a>00140                                                         null,
<a name="l00141"></a>00141                                                         null,
<a name="l00142"></a>00142                                                         { <span class="stringliteral">&quot;bVisible&quot;</span>: <span class="keyword">false</span> },
<a name="l00143"></a>00143                                                         { <span class="stringliteral">&quot;bVisible&quot;</span>: <span class="keyword">false</span> },
<a name="l00144"></a>00144                                                         $tableJqueryStuff
<a name="l00145"></a>00145                                                         null
<a name="l00146"></a>00146 STUFF;
<a name="l00147"></a>00147         
<a name="l00148"></a>00148         $smarttable = <a class="code" href="classsmarttable.html#a2a61fd65b31e7b27adb58e9b77865386">smarttable::render</a>(array(<span class="stringliteral">&#39;userstable&#39;</span>),array(<span class="stringliteral">&#39;userstable&#39;</span>=&gt;array(<span class="stringliteral">&#39;aoColumns&#39;</span>=&gt;<span class="stringliteral">&quot;$tableJqueryStuff&quot;</span>)));
<a name="l00149"></a>00149         
<a name="l00150"></a>00150         $STARTSCRIPTS.=<span class="stringliteral">&quot;initSmartTable();&quot;</span>;
<a name="l00151"></a>00151         
<a name="l00152"></a>00152         
<a name="l00153"></a>00153         $userListHtml = &lt;&lt;&lt;HEAD
<a name="l00154"></a>00154         $smarttable
<a name="l00155"></a>00155         &lt;script <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&quot;text/javascript&quot;</span> charset=<span class="stringliteral">&quot;utf-8&quot;</span>&gt;
<a name="l00156"></a>00156                         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> fnShowHide( iCol )
<a name="l00157"></a>00157                         {
<a name="l00158"></a>00158                                 var bVis = oTable.fnSettings().aoColumns[iCol].bVisible;
<a name="l00159"></a>00159                                 oTable.fnSetColumnVis( iCol, bVis ? <span class="keyword">false</span> : <span class="keyword">true</span> );
<a name="l00160"></a>00160                         }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162         &lt;/script&gt;
<a name="l00163"></a>00163 
<a name="l00164"></a>00164 HEAD;
<a name="l00165"></a>00165         
<a name="l00166"></a>00166         global <a class="code" href="index_8php.html#a230fc573246b14390d9e8aef2f7daa59" title="Stores all the icons locations without the.">$ICONS_SRC</a>,<a class="code" href="index_8php.html#aea13187bd6a0a1f26eea8f6b1d51a677" title="Stores all the icons locations along with.">$ICONS</a>;
<a name="l00167"></a>00167         $userListHtml .= <span class="stringliteral">&quot;&lt;h3&gt;User Submissions for Quiz: {$query[0]}&lt;/h3&gt;</span>
<a name="l00168"></a>00168 <span class="stringliteral">                &lt;fieldset&gt;&lt;legend&gt;Select Columns&lt;/legend&gt;&lt;table&gt;$toggleColumns&lt;/table&gt;&lt;/fieldset&gt;&quot;</span> .
<a name="l00169"></a>00169                 <span class="stringliteral">&quot;&lt;form action=&#39;./+correct&#39; method=POST&gt;&lt;input type=&#39;submit&#39; value=&#39;Recalculate Marks&#39; name=&#39;btnRecalculateMarks&#39; /&gt;&lt;/form&gt;</span>
<a name="l00170"></a>00170 <span class="stringliteral">                &lt;table class=\&quot;userlisttable display\&quot; border=\&quot;1\&quot; id=&#39;userstable&#39;&gt;&quot;</span> .
<a name="l00171"></a>00171                 <span class="stringliteral">&quot;&lt;thead&gt;&lt;tr&gt;&lt;th&gt;User Full Name&lt;/th&gt;&lt;th&gt;User Email&lt;/th&gt;&lt;th&gt;Total Marks&lt;/th&gt;&lt;th&gt;Time Taken&lt;/th&gt;&lt;th&gt;Started&lt;/th&gt;&lt;th&gt;Finished&lt;/th&gt;$sectionHead&lt;th&gt;Action&lt;/th&gt;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;</span>;
<a name="l00172"></a>00172         <span class="keywordflow">while</span> ($markRow = mysql_fetch_assoc($markResult)) {
<a name="l00173"></a>00173                 $userMarks = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00174"></a>00174                 $marksResult = mysql_query(<span class="stringliteral">&quot;SELECT `quiz_marksallotted`,`quiz_sectionid` FROM `quiz_userattempts` WHERE `user_id` = {$markRow[&#39;user_id&#39;]} AND `page_modulecomponentid` = $quizId ORDER BY `quiz_sectionid`&quot;</span>);
<a name="l00175"></a>00175                 $cc=1;
<a name="l00176"></a>00176                 
<a name="l00177"></a>00177                 <span class="keywordflow">while</span>($row = mysql_fetch_array($marksResult))
<a name="l00178"></a>00178                 {
<a name="l00179"></a>00179                         
<a name="l00180"></a>00180                         <span class="keywordflow">if</span>($row[<span class="stringliteral">&#39;quiz_sectionid&#39;</span>]!=$cc) <span class="comment">// To check if some sections are missing, if yes then add NA value</span>
<a name="l00181"></a>00181                         {       
<a name="l00182"></a>00182                                 <span class="keywordflow">while</span>($row[<span class="stringliteral">&#39;quiz_sectionid&#39;</span>]&gt;$cc) { $userMarks .= <span class="stringliteral">&quot;&lt;td&gt;-0&lt;/td&gt;&quot;</span>; $cc++; }
<a name="l00183"></a>00183                         }
<a name="l00184"></a>00184                         $userMarks .= <span class="stringliteral">&quot;&lt;td&gt;{$row[&#39;quiz_marksallotted&#39;]}&lt;/td&gt;&quot;</span>;
<a name="l00185"></a>00185                         $cc++;
<a name="l00186"></a>00186                         
<a name="l00187"></a>00187                 }
<a name="l00188"></a>00188                 
<a name="l00189"></a>00189                 <span class="keywordflow">while</span>($cc&lt;=$numSecColumns) {  $userMarks .= <span class="stringliteral">&quot;&lt;td&gt;-0&lt;/td&gt;&quot;</span>; $cc++;}
<a name="l00190"></a>00190                 <span class="keywordflow">if</span> (is_null($markRow[<span class="stringliteral">&#39;finishtime&#39;</span>])) {
<a name="l00191"></a>00191                         $markRow[<span class="stringliteral">&#39;finished&#39;</span>] = 0;
<a name="l00192"></a>00192                         $markRow[<span class="stringliteral">&#39;finishtime&#39;</span>] = <span class="stringliteral">&#39;NULL&#39;</span>;
<a name="l00193"></a>00193                 }
<a name="l00194"></a>00194                 $userfullname=<a class="code" href="common_8lib_8php.html#a7701caba48871fa8cb31ab723b1ff3e7">getUserFullNameFromEmail</a>($markRow[<span class="stringliteral">&#39;email&#39;</span>]);
<a name="l00195"></a>00195                 <span class="keywordflow">if</span>($userfullname==<span class="stringliteral">&quot;&quot;</span>) $userfullname=<span class="stringliteral">&quot;Anonymous&quot;</span>;
<a name="l00196"></a>00196                 $userListHtml .= <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;$userfullname&lt;/td&gt;&lt;td&gt;{$markRow[&#39;email&#39;]}&lt;/td&gt;&lt;td&gt;{$markRow[&#39;total&#39;]}&lt;/td&gt;&lt;td&gt;{$markRow[&#39;timetaken&#39;]}&lt;/td&gt;&lt;td&gt;{$markRow[&#39;starttime&#39;]}&lt;/td&gt;&lt;td&gt;{$markRow[&#39;finishtime&#39;]}&lt;/td&gt;$userMarks&quot;</span>;
<a name="l00197"></a>00197                 $userListHtml .= <span class="stringliteral">&#39;&lt;td&gt;&lt;form name=&quot;userclearform&quot; method=&quot;POST&quot; action=&quot;&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;hdnUserId&quot; id=&quot;hdnUserId&quot; value=&quot;&#39;</span> . $markRow[<span class="stringliteral">&#39;user_id&#39;</span>] . <span class="stringliteral">&quot;\&quot; /&gt;&lt;a href=\&quot;./+correct&amp;useremail={$markRow[&#39;email&#39;]}\&quot;&gt;&quot;</span>.$ICONS[<span class="stringliteral">&#39;Correct&#39;</span>][<span class="stringliteral">&#39;small&#39;</span>].<span class="stringliteral">&#39;&lt;/a&gt;&lt;input type=&quot;image&quot; src=&quot;&#39;</span>.$ICONS_SRC[<span class="stringliteral">&quot;Delete&quot;</span>][<span class="stringliteral">&quot;small&quot;</span>].<span class="stringliteral">&#39;&quot; name=&quot;btnDeleteUser&quot; id=&quot;btnDeleteUser&quot; value=&quot;Reject Submission&quot; title=&quot;Reject Submission&quot;/&gt;&lt;/form&gt;&lt;/td&gt;&#39;</span>;
<a name="l00198"></a>00198                 $userListHtml .= <span class="stringliteral">&quot;&lt;/tr&gt;\n&quot;</span>;
<a name="l00199"></a>00199         }
<a name="l00200"></a>00200         $userListHtml .= <span class="stringliteral">&quot;&lt;/tbody&gt;&lt;/table&gt;\n&quot;</span>;
<a name="l00201"></a>00201 
<a name="l00202"></a>00202         <span class="keywordflow">return</span> $userListHtml;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a><a class="code" href="quizcorrect_8php.html#a2aa4c42e3dcb24468fbddc520765b171">00205</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="quizcorrect_8php.html#a2aa4c42e3dcb24468fbddc520765b171">getQuizCorrectForm</a>($quizId, <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>) {
<a name="l00206"></a>00206         $marks = mysql_fetch_array(mysql_query(<span class="stringliteral">&quot;SELECT SUM(`quiz_marksallotted`) AS `total`, MIN(`quiz_attemptstarttime`) AS `starttime`, MAX(`quiz_submissiontime`) AS `finishtime`, TIMEDIFF(MAX(`quiz_submissiontime`), MIN(`quiz_attemptstarttime`)) AS `timetaken` FROM `quiz_userattempts` WHERE `user_id` = {$userId} AND `page_modulecomponentid` = $quizId&quot;</span>));
<a name="l00207"></a>00207         $title = mysql_fetch_array(mysql_query(<span class="stringliteral">&quot;SELECT `quiz_title` FROM `quiz_descriptions` WHERE `page_modulecomponentid` = &#39;$quizId&#39;&quot;</span>));
<a name="l00208"></a>00208 
<a name="l00209"></a>00209         $correctFormHtml = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00210"></a>00210         $sectionHead=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00211"></a>00211 
<a name="l00212"></a>00212         $sections = mysql_query(<span class="stringliteral">&quot;SELECT `quiz_sections`.`quiz_sectiontitle` AS `quiz_sectiontitle`, `quiz_sections`.`quiz_sectionid` AS `quiz_sectionid`, `quiz_marksallotted` FROM `quiz_userattempts` JOIN `quiz_sections` ON `quiz_userattempts`.`quiz_sectionid` = `quiz_sections`.`quiz_sectionid` WHERE `user_id` = $userId AND `quiz_userattempts`.`page_modulecomponentid` = $quizId AND `quiz_sections`.`page_modulecomponentid` = $quizId&quot;</span>);
<a name="l00213"></a>00213         
<a name="l00214"></a>00214         <span class="keywordflow">while</span>($sectionsRow = mysql_fetch_array($sections)) {
<a name="l00215"></a>00215         $correctFormHtml .= <span class="stringliteral">&quot;&lt;h4&gt;{$sectionsRow[&#39;quiz_sectiontitle&#39;]}(Marks: {$sectionsRow[&#39;quiz_marksallotted&#39;]})&lt;/h4&gt;&quot;</span>;
<a name="l00216"></a>00216         $sectionHead .=<span class="stringliteral">&quot;&lt;td&gt;&lt;b&gt;{$sectionsRow[&#39;quiz_sectiontitle&#39;]}&lt;/b&gt; section marks: {$sectionsRow[&#39;quiz_marksallotted&#39;]}&lt;/td&gt;&quot;</span>;
<a name="l00217"></a>00217         
<a name="l00218"></a>00218         
<a name="l00219"></a>00219         $questionQuery = <span class="stringliteral">&quot;SELECT `quiz_questions`.`quiz_questionid` AS `quiz_questionid`, &quot;</span> .
<a name="l00220"></a>00220                         <span class="stringliteral">&quot;`quiz_questions`.`quiz_question` AS `quiz_question`, `quiz_questiontype`, &quot;</span> .
<a name="l00221"></a>00221                         <span class="stringliteral">&quot;`quiz_rightanswer`, `quiz_submittedanswer`, `quiz_marksallotted`,`quiz_questions`.`quiz_sectionid` &quot;</span> .
<a name="l00222"></a>00222                         <span class="stringliteral">&quot;FROM `quiz_questions`, `quiz_answersubmissions` WHERE &quot;</span> .
<a name="l00223"></a>00223                         <span class="stringliteral">&quot;`quiz_questions`.`page_modulecomponentid` = $quizId AND &quot;</span> .
<a name="l00224"></a>00224                         <span class="stringliteral">&quot;`quiz_questions`.`page_modulecomponentid` = `quiz_answersubmissions`.`page_modulecomponentid` AND &quot;</span> .
<a name="l00225"></a>00225                         <span class="stringliteral">&quot;`quiz_questions`.`quiz_sectionid` = `quiz_answersubmissions`.`quiz_sectionid` AND &quot;</span> .
<a name="l00226"></a>00226                         <span class="stringliteral">&quot;`quiz_questions`.`quiz_questionid` = `quiz_answersubmissions`.`quiz_questionid` AND &quot;</span> .
<a name="l00227"></a>00227                         <span class="stringliteral">&quot;`quiz_questions`.`quiz_sectionid` = {$sectionsRow[&#39;quiz_sectionid&#39;]} AND &quot;</span> .
<a name="l00228"></a>00228                         <span class="stringliteral">&quot;`user_id` = $userId ORDER BY `quiz_answersubmissions`.`quiz_questionrank`&quot;</span>;
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231         $questionResult = mysql_query($questionQuery);
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         <span class="keywordflow">if</span> (!$questionResult)
<a name="l00234"></a>00234                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>($questionQuery . <span class="stringliteral">&#39;&lt;br /&gt;&#39;</span> . mysql_error());
<a name="l00235"></a>00235         
<a name="l00236"></a>00236         <span class="keywordflow">while</span> ($questionRow = mysql_fetch_assoc($questionResult)) {
<a name="l00237"></a>00237                 $correctFormHtml .= <span class="stringliteral">&#39;&lt;table class=&quot;quiz_&#39;</span> . (is_null($questionRow[<span class="stringliteral">&#39;quiz_marksallotted&#39;</span>]) || floatval($questionRow[<span class="stringliteral">&#39;quiz_marksallotted&#39;</span>]) &lt;= 0 ? <span class="stringliteral">&#39;wrong&#39;</span> : <span class="stringliteral">&#39;right&#39;</span>) . <span class="stringliteral">&quot;answer\&quot;&gt;&lt;tr&gt;&lt;td colspan=\&quot;2\&quot;&gt;{$questionRow[&#39;quiz_question&#39;]}&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00238"></a>00238                 <span class="keywordflow">if</span> ($questionRow[<span class="stringliteral">&#39;quiz_questiontype&#39;</span>] == <span class="stringliteral">&#39;subjective&#39;</span>) {
<a name="l00239"></a>00239                         $submittedAnswers = array();
<a name="l00240"></a>00240                         $submittedAnswers[] = $questionRow[<span class="stringliteral">&#39;quiz_submittedanswer&#39;</span>];
<a name="l00241"></a>00241                         $correctAnswers = array();
<a name="l00242"></a>00242                         $correctAnswers[] = $questionRow[<span class="stringliteral">&#39;quiz_rightanswer&#39;</span>];
<a name="l00243"></a>00243                         $correctFormHtml .= <span class="stringliteral">&#39;&lt;tr&gt;&lt;td nowrap=&quot;nowrap&quot; width=&quot;10%&quot;&gt;Submitted Answer:&lt;/td&gt;&lt;td&gt;&#39;</span>.implode(<span class="stringliteral">&quot;&lt;br /&gt;\n&quot;</span>, $submittedAnswers) . <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00244"></a>00244                         $correctFormHtml .= <span class="stringliteral">&#39;&lt;tr&gt;&lt;td nowrap=&quot;nowrap&quot; width=&quot;10%&quot;&gt;Correct Answer:&lt;/td&gt;&lt;td&gt;&#39;</span>.implode(<span class="stringliteral">&quot;&lt;br /&gt;\n&quot;</span>, $correctAnswers) . <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>; 
<a name="l00245"></a>00245                         $correctFormHtml .= <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Mark:&lt;/td&gt;&lt;td&gt;&lt;form method=POST action=&#39;./+correct&amp;useremail=&quot;</span> . <a class="code" href="common_8lib_8php.html#a174ddeb0ed4c3b5d55115d4eae7a139e">safe_html</a>($_GET[<span class="stringliteral">&#39;useremail&#39;</span>]) . <span class="stringliteral">&quot;&#39;&gt;&lt;input type=hidden name=quizid value=&#39;{$quizId}&#39;&gt;&lt;input type=hidden name=sectionid value={$questionRow[&#39;quiz_sectionid&#39;]}&gt;&lt;input type=hidden name=questionid value={$questionRow[&#39;quiz_questionid&#39;]}&gt;&lt;input type=hidden name=userid value={$userId}&gt;&lt;input type=text name=mark size=5 value=&#39;{$questionRow[&#39;quiz_marksallotted&#39;]}&#39;&gt;&lt;input type=submit value=&#39;Submit&#39; name=btnSetMark&gt;&lt;/form&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00246"></a>00246                 }
<a name="l00247"></a>00247                 elseif ($questionRow[<span class="stringliteral">&#39;quiz_questiontype&#39;</span>] == <span class="stringliteral">&#39;sso&#39;</span> || $questionRow[<span class="stringliteral">&#39;quiz_questiontype&#39;</span>] == <span class="stringliteral">&#39;mso&#39;</span>) {
<a name="l00248"></a>00248                         $optionList = <a class="code" href="quizedit_8php.html#abbcd2bc9f89fbd603b8f510e6d122c32">getQuestionOptionList</a>($quizId, $sectionsRow[<span class="stringliteral">&#39;quiz_sectionid&#39;</span>], $questionRow[<span class="stringliteral">&#39;quiz_questionid&#39;</span>]);
<a name="l00249"></a>00249                         $options = array();
<a name="l00250"></a>00250                         <span class="keywordflow">for</span> ($i = 0; $i &lt; count($optionList); ++$i)
<a name="l00251"></a>00251                                 $options[$optionList[$i][<span class="stringliteral">&#39;quiz_optionid&#39;</span>]] = $optionList[$i];
<a name="l00252"></a>00252 
<a name="l00253"></a>00253                         $correctAnswers = array();
<a name="l00254"></a>00254                         $rightAnswerIds = explode(<span class="charliteral">&#39;|&#39;</span>, $questionRow[<span class="stringliteral">&#39;quiz_rightanswer&#39;</span>]);
<a name="l00255"></a>00255                         <span class="keywordflow">for</span> ($i = 0; $i &lt; count($rightAnswerIds); ++$i)
<a name="l00256"></a>00256                                 $correctAnswers[] = $options[$rightAnswerIds[$i]][<span class="stringliteral">&#39;quiz_optiontext&#39;</span>];
<a name="l00257"></a>00257 
<a name="l00258"></a>00258                         $submittedAnswers = array();
<a name="l00259"></a>00259                         $submittedAnswerIds = explode(<span class="charliteral">&#39;|&#39;</span>, $questionRow[<span class="stringliteral">&#39;quiz_submittedanswer&#39;</span>]);
<a name="l00260"></a>00260                         <span class="keywordflow">for</span> ($i = 0; $i &lt; count($submittedAnswerIds); ++$i)
<a name="l00261"></a>00261                                 $submittedAnswers[] = $options[$submittedAnswerIds[$i]][<span class="stringliteral">&#39;quiz_optiontext&#39;</span>];
<a name="l00262"></a>00262                         $correctFormHtml .= <span class="stringliteral">&#39;&lt;tr&gt;&lt;td nowrap=&quot;nowrap&quot; width=&quot;10%&quot;&gt;Submitted Answer:&lt;/td&gt;&lt;td&gt;&#39;</span> . implode(<span class="stringliteral">&quot;&lt;br /&gt;\n&quot;</span>, $submittedAnswers) . <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00263"></a>00263                         $correctFormHtml .= <span class="stringliteral">&quot;&lt;tr&gt;&lt;td nowrap=\&quot;nowrap\&quot; width=\&quot;10%\&quot;&gt;Correct Answer:&lt;/td&gt;&lt;td&gt;&quot;</span> . implode(<span class="stringliteral">&quot;&lt;br /&gt;\n&quot;</span>, $correctAnswers) . <span class="stringliteral">&quot;&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>;
<a name="l00264"></a>00264                         $correctFormHtml .= <span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;Mark:&lt;/td&gt;&lt;td&gt;{$questionRow[&#39;quiz_marksallotted&#39;]}&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00265"></a>00265                 }
<a name="l00266"></a>00266                 $correctFormHtml .= <span class="stringliteral">&quot;&lt;/table&gt;\n&quot;</span>;
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269         $quizcorrectinfo=<span class="stringliteral">&quot;&lt;h3&gt;{$title[&#39;quiz_title&#39;]} - Quiz Answers Correct form for user: &quot;</span> . <a class="code" href="common_8lib_8php.html#a174ddeb0ed4c3b5d55115d4eae7a139e">safe_html</a>($_GET[<span class="stringliteral">&#39;useremail&#39;</span>]) . <span class="stringliteral">&quot;&lt;/h3&gt;&lt;form name=&#39;userclearform&#39; method=&#39;POST&#39; action=&#39;./+correct&#39;&gt;&lt;a href=&#39;./+correct&#39;&gt;&amp;lt;&amp;lt;Back&lt;/a&gt; &amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;input type=&#39;hidden&#39; name=&#39;hdnUserId&#39; id=&#39;hdnUserId&#39; value=&#39;{$userId}&#39; /&gt;&lt;input type=&#39;submit&#39; name=&#39;btnDeleteUser&#39; id=&#39;btnDeleteUser&#39; value=&#39;Reject Submission&#39; /&gt;&lt;/form&gt;&lt;table width=100%&gt;&lt;tr&gt;&lt;td&gt;Total marks: {$marks[&#39;total&#39;]}&lt;/td&gt;$sectionHead&lt;td&gt;Start time: {$marks[&#39;starttime&#39;]}&lt;/td&gt;&lt;td&gt;Finish time: {$marks[&#39;finishtime&#39;]}&lt;/td&gt;&lt;td&gt;Time taken: {$marks[&#39;timetaken&#39;]}&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;</span>;
<a name="l00270"></a>00270         $correctFormHtml .= <span class="stringliteral">&quot;&lt;a href=&#39;./+correct&#39;&gt;&amp;lt;&amp;lt;Back&lt;/a&gt;&quot;</span>;
<a name="l00271"></a>00271         <span class="keywordflow">return</span> $quizcorrectinfo.$correctFormHtml;
<a name="l00272"></a>00272 }
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 2 2011 04:55:32 for Pragyan CMS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
