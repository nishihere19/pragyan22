<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Pragyan CMS: cms/users.lib.php Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
  <div class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<div class="header">
  <div class="headertitle">
<h1>cms/users.lib.php</h1>  </div>
</div>
<div class="contents">
<a href="users_8lib_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="keywordflow">if</span>(!defined(<span class="stringliteral">&#39;__PRAGYAN_CMS&#39;</span>))
<a name="l00003"></a>00003 { 
<a name="l00004"></a>00004         header($_SERVER[<span class="stringliteral">&#39;SERVER_PROTOCOL&#39;</span>].<span class="stringliteral">&#39; 403 Forbidden&#39;</span>);
<a name="l00005"></a>00005         echo <span class="stringliteral">&quot;&lt;h1&gt;403 Forbidden&lt;h1&gt;&lt;h4&gt;You are not authorized to access the page.&lt;/h4&gt;&quot;</span>;
<a name="l00006"></a>00006         echo <span class="stringliteral">&#39;&lt;hr/&gt;&#39;</span>.$_SERVER[<span class="stringliteral">&#39;SERVER_SIGNATURE&#39;</span>];
<a name="l00007"></a>00007         exit(1);
<a name="l00008"></a>00008 }
<a name="l00017"></a>00017 <span class="comment">//TODO : Implement Search based on user profile fields</span>
<a name="l00018"></a><a class="code" href="users_8lib_8php.html#af6ac94469d464d5fbaf2be9788a482e3">00018</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="users_8lib_8php.html#af6ac94469d464d5fbaf2be9788a482e3">userManagementForm</a>()
<a name="l00019"></a>00019 {
<a name="l00020"></a>00020         global <a class="code" href="index_8php.html#aea13187bd6a0a1f26eea8f6b1d51a677" title="Stores all the icons locations along with.">$ICONS</a>;
<a name="l00021"></a>00021         global <a class="code" href="icons_8lib_8php.html#aedb76478d4528f9a7238cb660ba23f41">$urlRequestRoot</a>, <a class="code" href="icons_8lib_8php.html#a0fa2c9191ec4f6bb08bd885031af226c">$cmsFolder</a>, <a class="code" href="common_8lib_8php.html#aff25c40f48b4e124ac84533f8dbd0b4d">$moduleFolder</a>, <a class="code" href="icons_8lib_8php.html#a2654f4b5167de5bf124544b36647f7c4">$templateFolder</a>,<a class="code" href="common_8lib_8php.html#af6e6b8785607da4a06f0ab2ebd67e518">$sourceFolder</a>;
<a name="l00022"></a>00022         require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/viewregistrants.php&quot;</span>);
<a name="l00023"></a>00023         $usermgmtform=&lt;&lt;&lt;USERFORM
<a name="l00024"></a>00024         &lt;script <a class="code" href="cms_2templates_2blue__banks_2index_8php.html#a5b4586081f28ba5c2b7326fc2d4ca512">type</a>=<span class="stringliteral">&#39;text/javascript&#39;</span> language=<span class="stringliteral">&#39;javascript&#39;</span>&gt;
<a name="l00025"></a>00025         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> checkAll(formobj)
<a name="l00026"></a>00026         {
<a name="l00027"></a>00027                 <span class="keywordflow">for</span>(i=0;i&lt;formobj.elements.length;i++)
<a name="l00028"></a>00028                 {
<a name="l00029"></a>00029                         
<a name="l00030"></a>00030                         <span class="keywordflow">if</span>(formobj.elements[i].type==<span class="stringliteral">&#39;checkbox&#39;</span>) formobj.elements[i].checked=<span class="keyword">true</span>;
<a name="l00031"></a>00031                 }
<a name="l00032"></a>00032         }
<a name="l00033"></a>00033         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> unCheckAll(formobj)
<a name="l00034"></a>00034         {
<a name="l00035"></a>00035                 <span class="keywordflow">for</span>(i=0;i&lt;formobj.elements.length;i++)
<a name="l00036"></a>00036                 {
<a name="l00037"></a>00037                         
<a name="l00038"></a>00038                         <span class="keywordflow">if</span>(formobj.elements[i].type==<span class="stringliteral">&#39;checkbox&#39;</span>) formobj.elements[i].checked=<span class="keyword">false</span>;
<a name="l00039"></a>00039                 }
<a name="l00040"></a>00040         }
<a name="l00041"></a>00041         &lt;/script&gt;
<a name="l00042"></a>00042         &lt;<a class="code" href="classform.html">form</a> <a class="code" href="template_8lib_8php.html#a824aa20276005f0889ccb9ff6f1c5efd">name</a>=<span class="stringliteral">&#39;user_mgmt_form&#39;</span> action=<span class="stringliteral">&#39;./+admin&amp;subaction=useradmin&#39;</span> method=<span class="stringliteral">&#39;POST&#39;</span>&gt;
<a name="l00043"></a>00043         &lt;fieldset&gt;
<a name="l00044"></a>00044         &lt;legend&gt;{$ICONS[<span class="stringliteral">&#39;User Management&#39;</span>][<span class="stringliteral">&#39;small&#39;</span>]}User Management&lt;/legend&gt;
<a name="l00045"></a>00045         
<a name="l00046"></a>00046         Select Fields to Display : &lt;input type=<span class="stringliteral">&#39;button&#39;</span> onclick=<span class="stringliteral">&#39;return checkAll(this.form);&#39;</span> value=<span class="stringliteral">&#39;Check All&#39;</span> /&gt;&lt;input type=<span class="stringliteral">&#39;button&#39;</span> onclick=<span class="stringliteral">&#39;return unCheckAll(this.form);&#39;</span> value=<span class="stringliteral">&#39;Uncheck All&#39;</span> /&gt;
<a name="l00047"></a>00047         &lt;table&gt;&lt;tr&gt;&lt;td&gt;Field Name&lt;/td&gt;&lt;td&gt;Display ?&lt;/td&gt;&lt;td&gt;Field Name&lt;/td&gt;&lt;td&gt;Display ?&lt;/td&gt;&lt;td&gt;Field Name&lt;/td&gt;&lt;td&gt;Display ?&lt;/td&gt;&lt;/tr&gt;
<a name="l00048"></a>00048 USERFORM;
<a name="l00049"></a>00049         
<a name="l00050"></a>00050         $xcolumnNames=array_keys(<a class="code" href="viewregistrants_8php.html#a1ca94d552a61d6947459c04d852ba271">getColumnList</a>(0, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>));
<a name="l00051"></a>00051         $xcolumnPrettyNames=array_values(<a class="code" href="viewregistrants_8php.html#a1ca94d552a61d6947459c04d852ba271">getColumnList</a>(0, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>));
<a name="l00052"></a>00052         $usertablefields=array_merge(<a class="code" href="common_8lib_8php.html#ac8532aedf62e151b720f899097f298c2">getTableFieldsName</a>(<span class="stringliteral">&#39;users&#39;</span>),$xcolumnNames);
<a name="l00053"></a>00053         $userfieldprettynames=array_merge(array(<span class="stringliteral">&quot;User ID&quot;</span>,<span class="stringliteral">&quot;Username&quot;</span>,<span class="stringliteral">&quot;Email&quot;</span>,<span class="stringliteral">&quot;Full Name&quot;</span>,<span class="stringliteral">&quot;Password&quot;</span>,<span class="stringliteral">&quot;Registration&quot;</span>,<span class="stringliteral">&quot;Last Login&quot;</span>,<span class="stringliteral">&quot;Activated&quot;</span>,<span class="stringliteral">&quot;Login Method&quot;</span>),array_map(<span class="stringliteral">&#39;ucfirst&#39;</span>,$xcolumnPrettyNames));
<a name="l00054"></a>00054         $cols=3;
<a name="l00055"></a>00055         <span class="keywordflow">for</span>($i=0;$i&lt;count($usertablefields);$i=$i+$cols)
<a name="l00056"></a>00056         {       
<a name="l00057"></a>00057                 $usermgmtform.=<span class="stringliteral">&quot;&lt;tr&gt;&quot;</span>;
<a name="l00058"></a>00058                 <span class="keywordflow">for</span>($j=0;$j&lt;$cols;$j++)
<a name="l00059"></a>00059                 {
<a name="l00060"></a>00060                         <span class="keywordflow">if</span>($i+$j&lt;count($usertablefields))
<a name="l00061"></a>00061                         {
<a name="l00062"></a>00062                                 $checked=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00063"></a>00063                                 <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;not_first_time&#39;</span>]))
<a name="l00064"></a>00064                                         $checked=isset($_POST[$usertablefields[$i+$j].<span class="stringliteral">&#39;_sel&#39;</span>])?<span class="stringliteral">&quot;checked&quot;</span>:<span class="stringliteral">&quot;&quot;</span>;
<a name="l00065"></a>00065                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>($usertablefields[$i+$j]==<span class="stringliteral">&quot;user_fullname&quot;</span> || $usertablefields[$i+$j]==<span class="stringliteral">&quot;user_email&quot;</span> || $usertablefields[$i+$j]==<span class="stringliteral">&quot;user_activated&quot;</span>)
<a name="l00066"></a>00066                                         $checked=<span class="stringliteral">&quot;checked&quot;</span>;
<a name="l00067"></a>00067                                 
<a name="l00068"></a>00068                                 $usermgmtform.=<span class="stringliteral">&quot;&lt;td&gt;{$userfieldprettynames[$i+$j]}&lt;/td&gt;&lt;td&gt;&lt;input type=&#39;checkbox&#39; name=&#39;{$usertablefields[$i+$j]}_sel&#39; $checked /&gt;&lt;/td&gt;&quot;</span>;
<a name="l00069"></a>00069                         }
<a name="l00070"></a>00070                 }
<a name="l00071"></a>00071                 $usermgmtform.=<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073         global <a class="code" href="index_8php.html#a230fc573246b14390d9e8aef2f7daa59" title="Stores all the icons locations without the.">$ICONS_SRC</a>;
<a name="l00074"></a>00074         $usermgmtform.=&lt;&lt;&lt;USERFORM
<a name="l00075"></a>00075         &lt;input type=<span class="stringliteral">&#39;hidden&#39;</span> name=<span class="stringliteral">&#39;not_first_time&#39;</span> /&gt;
<a name="l00076"></a>00076         &lt;/table&gt;
<a name="l00077"></a>00077         &lt;fieldset style=<span class="stringliteral">&quot;float:left;&quot;</span>&gt;
<a name="l00078"></a>00078         &lt;legend&gt;All Registered&lt;/legend&gt;
<a name="l00079"></a>00079         &lt;input type=<span class="stringliteral">&#39;submit&#39;</span> value=<span class="stringliteral">&#39;View&#39;</span> name=<span class="stringliteral">&#39;view_reg_users&#39;</span>/&gt;
<a name="l00080"></a>00080         &lt;input type=<span class="stringliteral">&#39;submit&#39;</span> value=<span class="stringliteral">&#39;Edit&#39;</span> name=<span class="stringliteral">&#39;edit_reg_users&#39;</span>/&gt;
<a name="l00081"></a>00081         &lt;/fieldset&gt;&amp;nbsp;
<a name="l00082"></a>00082         &lt;fieldset style=<span class="stringliteral">&quot;float:left;&quot;</span>&gt;
<a name="l00083"></a>00083         &lt;legend&gt;Activated Users&lt;/legend&gt;
<a name="l00084"></a>00084         &lt;input type=<span class="stringliteral">&#39;submit&#39;</span> value=<span class="stringliteral">&#39;View&#39;</span> name=<span class="stringliteral">&#39;view_activated_users&#39;</span>/&gt;
<a name="l00085"></a>00085         &lt;input type=<span class="stringliteral">&#39;submit&#39;</span> value=<span class="stringliteral">&#39;Edit&#39;</span> name=<span class="stringliteral">&#39;edit_activated_users&#39;</span>/&gt;
<a name="l00086"></a>00086         
<a name="l00087"></a>00087         &lt;/fieldset&gt;&amp;nbsp;
<a name="l00088"></a>00088         &lt;fieldset style=<span class="stringliteral">&quot;float:left;&quot;</span>&gt;
<a name="l00089"></a>00089         &lt;legend&gt;Non-Activated Users&lt;/legend&gt;
<a name="l00090"></a>00090         &lt;input type=<span class="stringliteral">&#39;submit&#39;</span> value=<span class="stringliteral">&#39;View&#39;</span> name=<span class="stringliteral">&#39;view_nonactivated_users&#39;</span>/&gt;
<a name="l00091"></a>00091         &lt;input type=<span class="stringliteral">&#39;submit&#39;</span> value=<span class="stringliteral">&#39;Edit&#39;</span> name=<span class="stringliteral">&#39;edit_nonactivated_users&#39;</span>/&gt;
<a name="l00092"></a>00092         
<a name="l00093"></a>00093         &lt;/fieldset&gt;
<a name="l00094"></a>00094         &lt;div style=<span class="stringliteral">&quot;clear:both&quot;</span>&gt;&lt;/div&gt;
<a name="l00095"></a>00095         &lt;hr/&gt;
<a name="l00096"></a>00096         &lt;table <span class="keyword">class</span>=<span class="stringliteral">&#39;iconspanel&#39;</span>&gt;
<a name="l00097"></a>00097         &lt;tr&gt;
<a name="l00098"></a>00098         &lt;td&gt;
<a name="l00099"></a>00099         &lt;input type=<span class="stringliteral">&quot;image&quot;</span> alt=<span class="stringliteral">&quot;Search User&quot;</span> src=<span class="stringliteral">&#39;{$ICONS_SRC[&#39;</span>Search<span class="stringliteral">&#39;][&#39;</span>large<span class="stringliteral">&#39;]}&#39;</span> onclick=<span class="stringliteral">&quot;this.form.action+=&#39;&amp;subsubaction=search&#39;&quot;</span> value=<span class="stringliteral">&quot;Search User&quot;</span> /&gt;&lt;br/&gt;Search User
<a name="l00100"></a>00100         &lt;/td&gt;
<a name="l00101"></a>00101         &lt;td&gt;
<a name="l00102"></a>00102         &lt;input type=<span class="stringliteral">&quot;image&quot;</span> alt=<span class="stringliteral">&quot;New User&quot;</span> src=<span class="stringliteral">&#39;{$ICONS_SRC[&#39;</span>New User<span class="stringliteral">&#39;][&#39;</span>large<span class="stringliteral">&#39;]}&#39;</span> onclick=<span class="stringliteral">&quot;this.form.action+=&#39;&amp;subsubaction=create&#39;&quot;</span> value=<span class="stringliteral">&quot;New User&quot;</span> /&gt;&lt;br/&gt;New User
<a name="l00103"></a>00103         &lt;/td&gt;
<a name="l00104"></a>00104         &lt;td&gt;
<a name="l00105"></a>00105         &lt;input type=<span class="stringliteral">&#39;image&#39;</span> alt=<span class="stringliteral">&quot;Deactivate All Users&quot;</span> src=<span class="stringliteral">&#39;{$ICONS_SRC[&#39;</span>Deactivate<span class="stringliteral">&#39;][&#39;</span>large<span class="stringliteral">&#39;]}&#39;</span> value=<span class="stringliteral">&#39;Deactivate All&#39;</span> name=<span class="stringliteral">&#39;deactivate_all_users&#39;</span>/&gt;&lt;br/&gt;Deactivate All Users
<a name="l00106"></a>00106         &lt;/td&gt;
<a name="l00107"></a>00107         &lt;td&gt;
<a name="l00108"></a>00108         &lt;input type=<span class="stringliteral">&#39;image&#39;</span> alt=<span class="stringliteral">&quot;Activate All Users&quot;</span> src=<span class="stringliteral">&#39;{$ICONS_SRC[&#39;</span>Activate<span class="stringliteral">&#39;][&#39;</span>large<span class="stringliteral">&#39;]}&#39;</span> value=<span class="stringliteral">&#39;Activate All&#39;</span> name=<span class="stringliteral">&#39;activate_all_users&#39;</span>/&gt;&lt;br/&gt;Activate All Users
<a name="l00109"></a>00109         &lt;/td&gt;
<a name="l00110"></a>00110         &lt;/tr&gt;
<a name="l00111"></a>00111         &lt;/table&gt;
<a name="l00112"></a>00112         &lt;/fieldset&gt;
<a name="l00113"></a>00113         
<a name="l00114"></a>00114         
<a name="l00115"></a>00115         &lt;/<a class="code" href="classform.html">form</a>&gt;
<a name="l00116"></a>00116 USERFORM;
<a name="l00117"></a>00117         <span class="keywordflow">return</span> $usermgmtform;
<a name="l00118"></a>00118 }
<a name="l00119"></a><a class="code" href="users_8lib_8php.html#a7ee4a851e8c2581b03a9722dc17528f1">00119</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="users_8lib_8php.html#a7ee4a851e8c2581b03a9722dc17528f1">handleUserMgmt</a>()
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121         global <a class="code" href="icons_8lib_8php.html#aedb76478d4528f9a7238cb660ba23f41">$urlRequestRoot</a>, <a class="code" href="icons_8lib_8php.html#a0fa2c9191ec4f6bb08bd885031af226c">$cmsFolder</a>, <a class="code" href="common_8lib_8php.html#aff25c40f48b4e124ac84533f8dbd0b4d">$moduleFolder</a>, <a class="code" href="icons_8lib_8php.html#a2654f4b5167de5bf124544b36647f7c4">$templateFolder</a>,<a class="code" href="common_8lib_8php.html#af6e6b8785607da4a06f0ab2ebd67e518">$sourceFolder</a>;
<a name="l00122"></a>00122         require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/viewregistrants.php&quot;</span>);
<a name="l00123"></a>00123         <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;userid&#39;</span>]))
<a name="l00124"></a>00124          $_GET[<span class="stringliteral">&#39;userid&#39;</span>]=<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_GET[<span class="stringliteral">&#39;userid&#39;</span>]);
<a name="l00125"></a>00125         <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>])) $_POST[<span class="stringliteral">&#39;editusertype&#39;</span>]=<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>]);
<a name="l00126"></a>00126         <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_activate&#39;</span>]))
<a name="l00127"></a>00127         {
<a name="l00128"></a>00128                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;UPDATE &quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users SET user_activated=1 WHERE user_id={$_GET[&#39;userid&#39;]}&quot;</span>;
<a name="l00129"></a>00129                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>))
<a name="l00130"></a>00130                         displayInfo(<span class="stringliteral">&quot;User Successfully Activated!&quot;</span>);
<a name="l00131"></a>00131                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;User Not Activated!&quot;</span>);
<a name="l00132"></a>00132                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>],<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00133"></a>00133         }
<a name="l00134"></a>00134         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;activate_all_users&#39;</span>]))
<a name="l00135"></a>00135         {
<a name="l00136"></a>00136                 
<a name="l00137"></a>00137                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;UPDATE &quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users SET user_activated=1&quot;</span>;
<a name="l00138"></a>00138                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>))
<a name="l00139"></a>00139                         displayInfo(<span class="stringliteral">&quot;All users activated successfully!&quot;</span>);
<a name="l00140"></a>00140                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Users Not Deactivated!&quot;</span>);
<a name="l00141"></a>00141                 
<a name="l00142"></a>00142                 <span class="keywordflow">return</span>;
<a name="l00143"></a>00143         }
<a name="l00144"></a>00144         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_deactivate&#39;</span>]))
<a name="l00145"></a>00145         {
<a name="l00146"></a>00146                 <span class="keywordflow">if</span>($_GET[<span class="stringliteral">&#39;userid&#39;</span>]==<a class="code" href="config_8inc_8php.html#adb95d54a65bf094c915e4e95e667667c">ADMIN_USERID</a>)
<a name="l00147"></a>00147                 {
<a name="l00148"></a>00148                         displayError(<span class="stringliteral">&quot;You cannot deactivate administrator!&quot;</span>);
<a name="l00149"></a>00149                         <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>],<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00150"></a>00150                 }
<a name="l00151"></a>00151                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;UPDATE &quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users SET user_activated=0 WHERE user_id={$_GET[&#39;userid&#39;]}&quot;</span>;
<a name="l00152"></a>00152                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>))
<a name="l00153"></a>00153                         displayInfo(<span class="stringliteral">&quot;User Successfully Deactivated!&quot;</span>);
<a name="l00154"></a>00154                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;User Not Deactivated!&quot;</span>);
<a name="l00155"></a>00155                 
<a name="l00156"></a>00156                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>],<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;deactivate_all_users&#39;</span>]))
<a name="l00159"></a>00159         {
<a name="l00160"></a>00160                 
<a name="l00161"></a>00161                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;UPDATE &quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users SET user_activated=0 WHERE user_id != &quot;</span>.ADMIN_USERID;
<a name="l00162"></a>00162                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>))
<a name="l00163"></a>00163                         displayInfo(<span class="stringliteral">&quot;All users deactivated successfully except Administrator!&quot;</span>);
<a name="l00164"></a>00164                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Users Not Deactivated!&quot;</span>);
<a name="l00165"></a>00165                 
<a name="l00166"></a>00166                 <span class="keywordflow">return</span>;
<a name="l00167"></a>00167         }
<a name="l00168"></a>00168         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_delete&#39;</span>]))
<a name="l00169"></a>00169         {
<a name="l00170"></a>00170                 <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>=$_GET[<span class="stringliteral">&#39;userid&#39;</span>];
<a name="l00171"></a>00171                 <span class="keywordflow">if</span>(<a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>==<a class="code" href="config_8inc_8php.html#adb95d54a65bf094c915e4e95e667667c">ADMIN_USERID</a>)
<a name="l00172"></a>00172                 {
<a name="l00173"></a>00173                         displayError(<span class="stringliteral">&quot;You cannot delete administrator!&quot;</span>);
<a name="l00174"></a>00174                         <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>],<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00175"></a>00175                 }
<a name="l00176"></a>00176                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;DELETE FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users` WHERE `user_id` = $userId&quot;</span>;
<a name="l00177"></a>00177                 <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>))
<a name="l00178"></a>00178                 {
<a name="l00179"></a>00179                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;DELETE FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;openid_users` WHERE `user_id` = $userId&quot;</span>;
<a name="l00180"></a>00180                         <span class="keywordflow">if</span>(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>))
<a name="l00181"></a>00181                         {
<a name="l00182"></a>00182                                 <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;User Successfully Deleted!&quot;</span>);
<a name="l00183"></a>00183                         }
<a name="l00184"></a>00184                         <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;User not deleted from OpenID database!&quot;</span>);
<a name="l00185"></a>00185                 }
<a name="l00186"></a>00186                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;User Not Deleted!&quot;</span>);
<a name="l00187"></a>00187                 
<a name="l00188"></a>00188                 
<a name="l00189"></a>00189                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>($_POST[<span class="stringliteral">&#39;editusertype&#39;</span>],<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00190"></a>00190                 
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_info&#39;</span>]) || (isset($_POST[<span class="stringliteral">&#39;user_info_update&#39;</span>])))
<a name="l00193"></a>00193         {       
<a name="l00194"></a>00194                 <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_info_update&#39;</span>]))
<a name="l00195"></a>00195                 {
<a name="l00196"></a>00196                         $updates = array();
<a name="l00197"></a>00197                         <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>=$_GET[<span class="stringliteral">&#39;userid&#39;</span>];
<a name="l00198"></a>00198                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT * FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users` WHERE `user_id`={$userId}&quot;</span>;
<a name="l00199"></a>00199                         $row=mysql_fetch_assoc(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>));
<a name="l00200"></a>00200                         $errors = <span class="keyword">false</span>;
<a name="l00201"></a>00201                         
<a name="l00202"></a>00202                         <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_name&#39;</span>]) &amp;&amp; $row[<span class="stringliteral">&#39;user_name&#39;</span>]!=$_POST[<span class="stringliteral">&#39;user_name&#39;</span>])
<a name="l00203"></a>00203                         {
<a name="l00204"></a>00204                                 $chkquery=<span class="stringliteral">&quot;SELECT * FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users` WHERE `user_name`=&#39;&quot;</span>.<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;user_name&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00205"></a>00205                                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query($chkquery) or die(<span class="stringliteral">&quot;failed  : $chkquery&quot;</span>);
<a name="l00206"></a>00206                                 <span class="keywordflow">if</span>(mysql_num_rows(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>)&gt;0) 
<a name="l00207"></a>00207                                 {
<a name="l00208"></a>00208                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;User Name already exists in database!&quot;</span>);
<a name="l00209"></a>00209                                         $errors=<span class="keyword">true</span>;
<a name="l00210"></a>00210                                 }
<a name="l00211"></a>00211                                 
<a name="l00212"></a>00212                         }
<a name="l00213"></a>00213                         
<a name="l00214"></a>00214                         
<a name="l00215"></a>00215                         <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;user_name&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;user_name&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>  &amp;&amp; $_POST[<span class="stringliteral">&#39;user_name&#39;</span>]!=$row[<span class="stringliteral">&#39;user_name&#39;</span>]) {
<a name="l00216"></a>00216                                 $updates[] = <span class="stringliteral">&quot;`user_name` = &#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_name&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00217"></a>00217                                 
<a name="l00218"></a>00218                         }
<a name="l00219"></a>00219                         <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;user_email&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>  &amp;&amp; $_POST[<span class="stringliteral">&#39;user_email&#39;</span>]!=$row[<span class="stringliteral">&#39;user_email&#39;</span>]) {
<a name="l00220"></a>00220                                 $updates[] = <span class="stringliteral">&quot;`user_email` = &#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_email&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00221"></a>00221                                 
<a name="l00222"></a>00222                         }
<a name="l00223"></a>00223                         <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;user_fullname&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;user_fullname&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>  &amp;&amp; $_POST[<span class="stringliteral">&#39;user_fullname&#39;</span>]!=$row[<span class="stringliteral">&#39;user_fullname&#39;</span>]) {
<a name="l00224"></a>00224                                 $updates[] = <span class="stringliteral">&quot;`user_fullname` = &#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_fullname&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00225"></a>00225                                 
<a name="l00226"></a>00226                         }
<a name="l00227"></a>00227                         
<a name="l00228"></a>00228                         <span class="keywordflow">if</span> ($_POST[<span class="stringliteral">&#39;user_password&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00229"></a>00229                                 
<a name="l00230"></a>00230                                 <span class="keywordflow">if</span> ($_POST[<span class="stringliteral">&#39;user_password&#39;</span>] != $_POST[<span class="stringliteral">&#39;user_password2&#39;</span>]) {
<a name="l00231"></a>00231                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&#39;Error! The New Password you entered does not match the password you typed in the Confirmation Box.&#39;</span>);                                     $errors=<span class="keyword">true</span>;
<a name="l00232"></a>00232                                 }
<a name="l00233"></a>00233                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>(md5($_POST[<span class="stringliteral">&#39;user_password&#39;</span>]) != $row[<span class="stringliteral">&#39;user_password&#39;</span>]) {
<a name="l00234"></a>00234                                         $updates[] = <span class="stringliteral">&quot;`user_password` = MD5(&#39;{$_POST[&#39;user_password&#39;]}&#39;)&quot;</span>;
<a name="l00235"></a>00235                                         
<a name="l00236"></a>00236                                 }
<a name="l00237"></a>00237                         }
<a name="l00238"></a>00238                         <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;user_regdate&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;user_regdate&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>  &amp;&amp; $_POST[<span class="stringliteral">&#39;user_regdate&#39;</span>]!=$row[<span class="stringliteral">&#39;user_regdate&#39;</span>]) {
<a name="l00239"></a>00239                                 $updates[] = <span class="stringliteral">&quot;`user_regdate` = &#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_regdate&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00240"></a>00240                                 
<a name="l00241"></a>00241                         }
<a name="l00242"></a>00242                         <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;user_lastlogin&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;user_lastlogin&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>  &amp;&amp; $_POST[<span class="stringliteral">&#39;user_lastlogin&#39;</span>]!=$row[<span class="stringliteral">&#39;user_lastlogin&#39;</span>]) {
<a name="l00243"></a>00243                                 $updates[] = <span class="stringliteral">&quot;`user_lastlogin` = &#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_lastlogin&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00244"></a>00244                                 
<a name="l00245"></a>00245                         }
<a name="l00246"></a>00246                         <span class="keywordflow">if</span> ($_GET[<span class="stringliteral">&#39;userid&#39;</span>]!=<a class="code" href="config_8inc_8php.html#adb95d54a65bf094c915e4e95e667667c">ADMIN_USERID</a> &amp;&amp; (isset($_POST[<span class="stringliteral">&#39;user_activated&#39;</span>])?1:0)!=$row[<span class="stringliteral">&#39;user_activated&#39;</span>]) {
<a name="l00247"></a>00247                                 $checked=isset($_POST[<span class="stringliteral">&#39;user_activated&#39;</span>])?1:0;
<a name="l00248"></a>00248                                 $updates[] = <span class="stringliteral">&quot;`user_activated` = $checked&quot;</span>;
<a name="l00249"></a>00249                                 
<a name="l00250"></a>00250                         }
<a name="l00251"></a>00251                         <span class="keywordflow">if</span> (isset($_POST[<span class="stringliteral">&#39;user_loginmethod&#39;</span>]) &amp;&amp; $_POST[<span class="stringliteral">&#39;user_loginmethod&#39;</span>] != <span class="stringliteral">&#39;&#39;</span>  &amp;&amp; $_POST[<span class="stringliteral">&#39;user_loginmethod&#39;</span>]!=$row[<span class="stringliteral">&#39;user_loginmethod&#39;</span>])     {
<a name="l00252"></a>00252                                 $updates[] = <span class="stringliteral">&quot;`user_loginmethod` = &#39;&quot;</span>.escape($_POST[<span class="stringliteral">&#39;user_loginmethod&#39;</span>]).<span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00253"></a>00253                                 <span class="keywordflow">if</span>($_POST[<span class="stringliteral">&#39;user_loginmethod&#39;</span>]!=<span class="stringliteral">&#39;db&#39;</span>)
<a name="l00254"></a>00254                                 <a class="code" href="common_8lib_8php.html#ada25164e4f2df73f68b14e35011c9674">displaywarning</a>(<span class="stringliteral">&quot;Please make sure &quot;</span>.strtoupper(<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[<span class="stringliteral">&#39;user_loginmethod&#39;</span>])).<span class="stringliteral">&quot; is configured properly, otherwise the user will not be able to login to the website.&quot;</span>);
<a name="l00255"></a>00255                         }
<a name="l00256"></a>00256 
<a name="l00257"></a>00257                         <span class="keywordflow">if</span>(!$errors) {
<a name="l00258"></a>00258                                 <span class="keywordflow">if</span>(count($updates) &gt; 0)
<a name="l00259"></a>00259                                 {
<a name="l00260"></a>00260                                         $profileQuery = <span class="stringliteral">&#39;UPDATE `&#39;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&#39;users` SET &#39;</span> . join($updates, <span class="stringliteral">&#39;, &#39;</span>) . <span class="stringliteral">&quot; WHERE `user_id` = {$_GET[&#39;userid&#39;]}&quot;</span>;
<a name="l00261"></a>00261                                         $profileResult = mysql_query($profileQuery);
<a name="l00262"></a>00262                                         <span class="keywordflow">if</span>(!$profileResult) {
<a name="l00263"></a>00263                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&#39;An error was encountered while attempting to process your request.&#39;</span>.$profileQuery);
<a name="l00264"></a>00264                                         $errors = <span class="keyword">true</span>;
<a name="l00265"></a>00265                                         }
<a name="l00266"></a>00266                                 }
<a name="l00267"></a>00267                                 global $sourceFolder,$moduleFolder;
<a name="l00268"></a>00268                 require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformsubmit.php&quot;</span>);
<a name="l00269"></a>00269                 require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformgenerate.php&quot;</span>);
<a name="l00270"></a>00270                                 <span class="keywordflow">if</span>(!$errors &amp;&amp; !<a class="code" href="registrationformsubmit_8bak_8php.html#a38e840621952d7270b5248cbbc821f41">submitRegistrationForm</a>(0, <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>, <span class="keyword">true</span>, <span class="keyword">true</span>)) {
<a name="l00271"></a>00271                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&#39;An error was encountered while attempting to process your request.&#39;</span>.$profileQuery);
<a name="l00272"></a>00272                                         $errors = <span class="keyword">true</span>;
<a name="l00273"></a>00273                                 }
<a name="l00274"></a>00274                                 <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&#39;All fields updated successfully!&#39;</span>);
<a name="l00275"></a>00275                         }
<a name="l00276"></a>00276                         
<a name="l00277"></a>00277                                 
<a name="l00278"></a>00278                                 
<a name="l00279"></a>00279                         
<a name="l00280"></a>00280                 }
<a name="l00281"></a>00281                 
<a name="l00282"></a>00282                 $userid=$_GET[<span class="stringliteral">&#39;userid&#39;</span>];
<a name="l00283"></a>00283                 <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT * FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users` WHERE `user_id`=$userid&quot;</span>;
<a name="l00284"></a>00284                 $columnList=<a class="code" href="viewregistrants_8php.html#a1ca94d552a61d6947459c04d852ba271">getColumnList</a>(0,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>);
<a name="l00285"></a>00285                 $xcolumnIds=array_keys($columnList);
<a name="l00286"></a>00286                 $xcolumnNames=array_values($columnList);
<a name="l00287"></a>00287                 
<a name="l00288"></a>00288                 $row=mysql_fetch_assoc(mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>));
<a name="l00289"></a>00289                 
<a name="l00290"></a>00290                 
<a name="l00291"></a>00291                 $userfieldprettynames=array(<span class="stringliteral">&quot;User ID&quot;</span>,<span class="stringliteral">&quot;Username&quot;</span>,<span class="stringliteral">&quot;Email&quot;</span>,<span class="stringliteral">&quot;Full Name&quot;</span>,<span class="stringliteral">&quot;Password&quot;</span>,<span class="stringliteral">&quot;Registration&quot;</span>,<span class="stringliteral">&quot;Last Login&quot;</span>,<span class="stringliteral">&quot;Activated&quot;</span>,<span class="stringliteral">&quot;Login Method&quot;</span>);        
<a name="l00292"></a>00292                 
<a name="l00293"></a>00293                 $userinfo=<span class="stringliteral">&quot;&lt;fieldset&gt;&lt;legend&gt;Edit User Information&lt;/legend&gt;&lt;form name=&#39;user_info_edit&#39; action=&#39;./+admin&amp;subaction=useradmin&amp;userid=$userid&#39; method=&#39;post&#39;&gt;&quot;</span>;
<a name="l00294"></a>00294                 
<a name="l00295"></a>00295                 
<a name="l00296"></a>00296                 
<a name="l00297"></a>00297                 
<a name="l00298"></a>00298                 $usertablefields=array_merge(<a class="code" href="common_8lib_8php.html#ac8532aedf62e151b720f899097f298c2">getTableFieldsName</a>(<span class="stringliteral">&#39;users&#39;</span>),$xcolumnNames);
<a name="l00299"></a>00299 
<a name="l00300"></a>00300                 <span class="keywordflow">for</span>($i=0;$i&lt;count($usertablefields);$i++)
<a name="l00301"></a>00301                         <span class="keywordflow">if</span>(isset($_POST[$usertablefields[$i].<span class="stringliteral">&#39;_sel&#39;</span>]))
<a name="l00302"></a>00302                                 $userinfo.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;{$usertablefields[$i]}_sel&#39; value=&#39;checked&#39;/&gt;&quot;</span>;
<a name="l00303"></a>00303                 $userinfo.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;not_first_time&#39; /&gt;&quot;</span>;
<a name="l00304"></a>00304                 
<a name="l00305"></a>00305         
<a name="l00306"></a>00306                 
<a name="l00307"></a>00307                 $userinfo.=<a class="code" href="users_8lib_8php.html#aeb3eab5260963cfb7ef73cc33d920206">userProfileForm</a>($userfieldprettynames,$row,<span class="keyword">false</span>,<span class="keyword">true</span>);
<a name="l00308"></a>00308                 $userinfo.=<span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; value=&#39;Update&#39; name=&#39;user_info_update&#39; /&gt;</span>
<a name="l00309"></a>00309 <span class="stringliteral">                &lt;input type=&#39;reset&#39; value=&#39;Reset&#39; /&gt;&lt;/form&gt;&lt;/fieldset&gt;&quot;</span>;
<a name="l00310"></a>00310                 <span class="keywordflow">return</span> $userinfo;
<a name="l00311"></a>00311         
<a name="l00312"></a>00312         
<a name="l00313"></a>00313         }
<a name="l00314"></a>00314         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;view_reg_users&#39;</span>]))
<a name="l00315"></a>00315         {
<a name="l00316"></a>00316                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;all&quot;</span>,<span class="stringliteral">&quot;view&quot;</span>,<span class="keyword">false</span>);
<a name="l00317"></a>00317         }
<a name="l00318"></a>00318         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;edit_reg_users&#39;</span>]))
<a name="l00319"></a>00319         {
<a name="l00320"></a>00320                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;all&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00321"></a>00321         }
<a name="l00322"></a>00322         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;view_activated_users&#39;</span>]))
<a name="l00323"></a>00323         {
<a name="l00324"></a>00324                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;activated&quot;</span>,<span class="stringliteral">&quot;view&quot;</span>,<span class="keyword">false</span>);
<a name="l00325"></a>00325         }
<a name="l00326"></a>00326         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;edit_activated_users&#39;</span>]))
<a name="l00327"></a>00327         {
<a name="l00328"></a>00328                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;activated&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00329"></a>00329         }
<a name="l00330"></a>00330         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;view_nonactivated_users&#39;</span>]))
<a name="l00331"></a>00331         {
<a name="l00332"></a>00332                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;nonactivated&quot;</span>,<span class="stringliteral">&quot;view&quot;</span>,<span class="keyword">false</span>);
<a name="l00333"></a>00333         }
<a name="l00334"></a>00334         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;edit_nonactivated_users&#39;</span>]))
<a name="l00335"></a>00335         {
<a name="l00336"></a>00336                 <span class="keywordflow">return</span> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;nonactivated&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>);
<a name="l00337"></a>00337         }
<a name="l00338"></a>00338         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;subsubaction&#39;</span>]) &amp;&amp; $_GET[<span class="stringliteral">&#39;subsubaction&#39;</span>]==<span class="stringliteral">&#39;search&#39;</span>)
<a name="l00339"></a>00339         {
<a name="l00340"></a>00340         
<a name="l00341"></a>00341                 $results=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00342"></a>00342                 
<a name="l00343"></a>00343                 
<a name="l00344"></a>00344                 $userfieldprettynames=array(<span class="stringliteral">&quot;User ID&quot;</span>,<span class="stringliteral">&quot;Username&quot;</span>,<span class="stringliteral">&quot;Email&quot;</span>,<span class="stringliteral">&quot;Full Name&quot;</span>,<span class="stringliteral">&quot;Password&quot;</span>,<span class="stringliteral">&quot;Registration&quot;</span>,<span class="stringliteral">&quot;Last Login&quot;</span>,<span class="stringliteral">&quot;Activated&quot;</span>,<span class="stringliteral">&quot;Login Method&quot;</span>);        
<a name="l00345"></a>00345                 
<a name="l00346"></a>00346 
<a name="l00347"></a>00347                 $usertablefields=<a class="code" href="common_8lib_8php.html#ac8532aedf62e151b720f899097f298c2">getTableFieldsName</a>(<span class="stringliteral">&#39;users&#39;</span>);
<a name="l00348"></a>00348                 
<a name="l00349"></a>00349                 $first=<span class="keyword">true</span>;
<a name="l00350"></a>00350                 
<a name="l00351"></a>00351                 $qstring=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00352"></a>00352                 <span class="keywordflow">foreach</span> ($usertablefields as $field) {
<a name="l00353"></a>00353                         <span class="keywordflow">if</span>(isset($_POST[$field]) &amp;&amp; $_POST[$field]!=<span class="stringliteral">&#39;&#39;</span>)
<a name="l00354"></a>00354                         {
<a name="l00355"></a>00355                                 <span class="keywordflow">if</span> ($first == <span class="keyword">false</span>)
<a name="l00356"></a>00356                                         $qstring .= ($_POST[<span class="stringliteral">&#39;user_search_op&#39;</span>]==<span class="stringliteral">&#39;and&#39;</span>)?<span class="stringliteral">&quot; AND &quot;</span>:<span class="stringliteral">&quot; OR &quot;</span>;
<a name="l00357"></a>00357                                 $val=<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[$field]);
<a name="l00358"></a>00358                                 <span class="keywordflow">if</span>($field==<span class="stringliteral">&#39;user_activated&#39;</span>) ${$field.<span class="stringliteral">&#39;_lastval&#39;</span>}=$val=isset($_POST[$field])?1:0;
<a name="l00359"></a>00359                                 <span class="keywordflow">else</span> ${$field.<span class="stringliteral">&#39;_lastval&#39;</span>}=$val;
<a name="l00360"></a>00360                                 $qstring .= <span class="stringliteral">&quot;`$field` LIKE CONVERT( _utf8 &#39;%$val%&#39;USING latin1 ) &quot;</span>;
<a name="l00361"></a>00361                                 $first=<span class="keyword">false</span>;
<a name="l00362"></a>00362                         }
<a name="l00363"></a>00363                 }
<a name="l00364"></a>00364                 <span class="keywordflow">if</span>($qstring!=<span class="stringliteral">&quot;&quot;</span>)
<a name="l00365"></a>00365                 {
<a name="l00366"></a>00366                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;SELECT * FROM `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` WHERE $qstring &quot;</span>;
<a name="l00367"></a>00367                         $resultSearch = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00368"></a>00368                         <span class="keywordflow">if</span> (mysql_num_rows($resultSearch) &gt; 0) {
<a name="l00369"></a>00369                                 $num = mysql_num_rows($resultSearch);
<a name="l00370"></a>00370                                 
<a name="l00371"></a>00371                                 $userInfo=array();
<a name="l00372"></a>00372                                 
<a name="l00373"></a>00373                                 
<a name="l00374"></a>00374                                 <span class="keywordflow">while</span>($row=mysql_fetch_assoc($resultSearch))
<a name="l00375"></a>00375                                 {
<a name="l00376"></a>00376                                         $userInfo[<span class="stringliteral">&#39;user_id&#39;</span>][]=$row[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00377"></a>00377                                         $userInfo[<span class="stringliteral">&#39;user_name&#39;</span>][]=$row[<span class="stringliteral">&#39;user_name&#39;</span>];
<a name="l00378"></a>00378                                         $userInfo[<span class="stringliteral">&#39;user_email&#39;</span>][]=$row[<span class="stringliteral">&#39;user_email&#39;</span>];
<a name="l00379"></a>00379                                         $userInfo[<span class="stringliteral">&#39;user_fullname&#39;</span>][]=$row[<span class="stringliteral">&#39;user_fullname&#39;</span>];
<a name="l00380"></a>00380                                         $userInfo[<span class="stringliteral">&#39;user_password&#39;</span>][]=$row[<span class="stringliteral">&#39;user_password&#39;</span>];
<a name="l00381"></a>00381                                         $userInfo[<span class="stringliteral">&#39;user_lastlogin&#39;</span>][]=$row[<span class="stringliteral">&#39;user_lastlogin&#39;</span>];
<a name="l00382"></a>00382                                         $userInfo[<span class="stringliteral">&#39;user_regdate&#39;</span>][]=$row[<span class="stringliteral">&#39;user_regdate&#39;</span>];
<a name="l00383"></a>00383                                         $userInfo[<span class="stringliteral">&#39;user_activated&#39;</span>][]=$row[<span class="stringliteral">&#39;user_activated&#39;</span>];
<a name="l00384"></a>00384                                         $userInfo[<span class="stringliteral">&#39;user_loginmethod&#39;</span>][]=$row[<span class="stringliteral">&#39;user_loginmethod&#39;</span>];       
<a name="l00385"></a>00385                                 }
<a name="l00386"></a>00386                                 $results=<a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>(<span class="stringliteral">&quot;all&quot;</span>,<span class="stringliteral">&quot;edit&quot;</span>,<span class="keyword">false</span>,$userInfo);
<a name="l00387"></a>00387                         } <span class="keywordflow">else</span>
<a name="l00388"></a>00388                                 <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;No users matched your query!&quot;</span>);
<a name="l00389"></a>00389                         
<a name="l00390"></a>00390                 }
<a name="l00391"></a>00391                 
<a name="l00392"></a>00392                 $searchForm=<span class="stringliteral">&quot;&lt;form name=&#39;user_search_form&#39; action=&#39;./+admin&amp;subaction=useradmin&amp;subsubaction=search&#39; method=&#39;POST&#39;&gt;&lt;h3&gt;Search User&lt;/h3&gt;&quot;</span>;
<a name="l00393"></a>00393                 $xcolumnNames=array_keys(<a class="code" href="viewregistrants_8php.html#a1ca94d552a61d6947459c04d852ba271">getColumnList</a>(0, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>));
<a name="l00394"></a>00394                 $usertablefields2=array_merge($usertablefields,$xcolumnNames);
<a name="l00395"></a>00395                 <span class="keywordflow">for</span>($i=0;$i&lt;count($usertablefields2);$i++)
<a name="l00396"></a>00396                         <span class="keywordflow">if</span>(isset($_POST[$usertablefields2[$i].<span class="stringliteral">&#39;_sel&#39;</span>]))
<a name="l00397"></a>00397                                 $searchForm.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;{$usertablefields2[$i]}_sel&#39; value=&#39;checked&#39;/&gt;&quot;</span>;
<a name="l00398"></a>00398                 $searchForm.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;not_first_time&#39; /&gt;&quot;</span>;
<a name="l00399"></a>00399                 
<a name="l00400"></a>00400                 $infoarray=array();
<a name="l00401"></a>00401                 <span class="keywordflow">foreach</span> ($usertablefields as $field)
<a name="l00402"></a>00402                         <span class="keywordflow">if</span>(isset(${$field.<span class="stringliteral">&#39;_lastval&#39;</span>}))
<a name="l00403"></a>00403                                 $infoarray[$field]=${$field.<span class="stringliteral">&#39;_lastval&#39;</span>};
<a name="l00404"></a>00404                         <span class="keywordflow">else</span> $infoarray[$field]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00405"></a>00405                         
<a name="l00406"></a>00406                 $searchForm.=<a class="code" href="users_8lib_8php.html#aeb3eab5260963cfb7ef73cc33d920206">userProfileForm</a>($userfieldprettynames,$infoarray,<span class="keyword">true</span>,<span class="keyword">false</span>);
<a name="l00407"></a>00407                 
<a name="l00408"></a>00408                 $searchForm.=<span class="stringliteral">&quot;Operation : &lt;input type=&#39;radio&#39; name=&#39;user_search_op&#39; value=&#39;and&#39;  /&gt;AND  &lt;input type=&#39;radio&#39; name=&#39;user_search_op&#39; value=&#39;or&#39; checked=&#39;true&#39; /&gt;OR&lt;br/&gt;&lt;br/&gt;&lt;input type=&#39;submit&#39; onclick name=&#39;user_search_submit&#39; value=&#39;Search&#39; /&gt;&lt;input type=&#39;reset&#39; value=&#39;Clear&#39; /&gt;&lt;/form&gt;&quot;</span>;
<a name="l00409"></a>00409                 <span class="keywordflow">return</span> $results.$searchForm;
<a name="l00410"></a>00410                 
<a name="l00411"></a>00411                 
<a name="l00412"></a>00412         }
<a name="l00413"></a>00413         
<a name="l00414"></a>00414         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(isset($_GET[<span class="stringliteral">&#39;subsubaction&#39;</span>]) &amp;&amp; $_GET[<span class="stringliteral">&#39;subsubaction&#39;</span>]==<span class="stringliteral">&#39;create&#39;</span>)
<a name="l00415"></a>00415         {
<a name="l00416"></a>00416                 
<a name="l00417"></a>00417                 
<a name="l00418"></a>00418                 $userfieldprettynamesarray=array(<span class="stringliteral">&quot;User ID&quot;</span>,<span class="stringliteral">&quot;Username&quot;</span>,<span class="stringliteral">&quot;Email&quot;</span>,<span class="stringliteral">&quot;Full Name&quot;</span>,<span class="stringliteral">&quot;Password&quot;</span>,<span class="stringliteral">&quot;Registration&quot;</span>,<span class="stringliteral">&quot;Last Login&quot;</span>,<span class="stringliteral">&quot;Activated&quot;</span>,<span class="stringliteral">&quot;Login Method&quot;</span>);   
<a name="l00419"></a>00419                 
<a name="l00420"></a>00420                 $usertablefields=<a class="code" href="common_8lib_8php.html#ac8532aedf62e151b720f899097f298c2">getTableFieldsName</a>(<span class="stringliteral">&#39;users&#39;</span>);
<a name="l00421"></a>00421                 
<a name="l00422"></a>00422                 <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;create_user_submit&#39;</span>]))
<a name="l00423"></a>00423                 {
<a name="l00424"></a>00424                         $incomplete=<span class="keyword">false</span>;
<a name="l00425"></a>00425                         <span class="keywordflow">foreach</span>($usertablefields as $field)
<a name="l00426"></a>00426                         {
<a name="l00427"></a>00427                                 <span class="keywordflow">if</span>(($field != <span class="stringliteral">&#39;user_regdate&#39;</span>) &amp;&amp; ($field != <span class="stringliteral">&#39;user_lastlogin&#39;</span>) &amp;&amp; ($field != <span class="stringliteral">&#39;user_activated&#39;</span>) &amp;&amp; (isset($_POST[$field]) &amp;&amp; $_POST[$field]==<span class="stringliteral">&quot;&quot;</span>))
<a name="l00428"></a>00428                                 {
<a name="l00429"></a>00429                                         <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;New user could not be created. Some fields are missing!$field&quot;</span>);
<a name="l00430"></a>00430                                         $incomplete=<span class="keyword">true</span>;
<a name="l00431"></a>00431                                         <span class="keywordflow">break</span>;
<a name="l00432"></a>00432                                 }
<a name="l00433"></a>00433                                 ${$field}=<a class="code" href="common_8lib_8php.html#a5c6bd309ef0f003235ad9fd0d90cc775">escape</a>($_POST[$field]);
<a name="l00434"></a>00434                         }
<a name="l00435"></a>00435                         <span class="keywordflow">if</span>(!$incomplete)
<a name="l00436"></a>00436                         {
<a name="l00437"></a>00437                                 $user_id=$_GET[<span class="stringliteral">&#39;userid&#39;</span>];
<a name="l00438"></a>00438                                 $chkquery=<span class="stringliteral">&quot;SELECT COUNT(user_id) FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users` WHERE `user_id`=$user_id OR `user_name`=&#39;$user_name&#39; OR `user_email`=&#39;$user_email&#39;&quot;</span>;
<a name="l00439"></a>00439                         
<a name="l00440"></a>00440                                 <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query($chkquery);
<a name="l00441"></a>00441                                 $row=mysql_fetch_row(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>);
<a name="l00442"></a>00442                         
<a name="l00443"></a>00443                                 <span class="keywordflow">if</span>($row[0]&gt;0) <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Another user with the same name or email already exists!&quot;</span>);
<a name="l00444"></a>00444                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>($user_password!=$_POST[<span class="stringliteral">&#39;user_password2&#39;</span>]) <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Passwords mismatch!&quot;</span>);
<a name="l00445"></a>00445                                 <span class="keywordflow">else</span> 
<a name="l00446"></a>00446                                 {
<a name="l00447"></a>00447                                         <span class="keywordflow">if</span>(isset($_POST[<span class="stringliteral">&#39;user_activated&#39;</span>])) $user_activated=1;
<a name="l00448"></a>00448                                         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a> = <span class="stringliteral">&quot;INSERT INTO `&quot;</span> . <a class="code" href="config_8inc_8php.html#a6e82c009b12320b713155acd894a9330">MYSQL_DATABASE_PREFIX</a> . <span class="stringliteral">&quot;users` (`user_id` ,`user_name` ,`user_email` ,`user_fullname` ,`user_password` ,`user_regdate` ,`user_lastlogin` ,`user_activated`,`user_loginmethod`)VALUES (&#39;$user_id&#39; ,&#39;$user_name&#39; ,&#39;$user_email&#39; ,&#39;$user_fullname&#39; , MD5(&#39;$user_password&#39;) ,CURRENT_TIMESTAMP , &#39;&#39;, &#39;$user_activated&#39;,&#39;$user_loginmethod&#39;)&quot;</span>;
<a name="l00449"></a>00449                                         <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a> = mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>) or die(mysql_error());
<a name="l00450"></a>00450                                         global $sourceFolder,$moduleFolder;
<a name="l00451"></a>00451                 require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformsubmit.php&quot;</span>);
<a name="l00452"></a>00452                 require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformgenerate.php&quot;</span>);
<a name="l00453"></a>00453                                         <span class="keywordflow">if</span> (mysql_affected_rows() &amp;&amp; <a class="code" href="registrationformsubmit_8bak_8php.html#a38e840621952d7270b5248cbbc821f41">submitRegistrationForm</a>(0, $user_id, <span class="keyword">true</span>, <span class="keyword">true</span>)) <a class="code" href="common_8lib_8php.html#aa3cfe8c6012285f143bc8aff8cd4a12d">displayinfo</a>(<span class="stringliteral">&quot;User $user_fullname Successfully Created!&quot;</span>);
<a name="l00454"></a>00454                                         <span class="keywordflow">else</span> <a class="code" href="common_8lib_8php.html#a3ea290f0cbed066526d9d71cb416727e">displayerror</a>(<span class="stringliteral">&quot;Failed to create user&quot;</span>);
<a name="l00455"></a>00455                                 }
<a name="l00456"></a>00456                         }
<a name="l00457"></a>00457                 }
<a name="l00458"></a>00458                 
<a name="l00459"></a>00459                 $nextUserId=<a class="code" href="common_8lib_8php.html#af86c26ce5f6c797bfa8421372d11c63b">getNextUserId</a>();
<a name="l00460"></a>00460                 $userForm=<span class="stringliteral">&quot;&lt;form name=&#39;user_create_form&#39; action=&#39;./+admin&amp;subaction=useradmin&amp;subsubaction=create&amp;userid=$nextUserId&#39; method=&#39;POST&#39;&gt;&lt;h3&gt;Create New User&lt;/h3&gt;&quot;</span>;
<a name="l00461"></a>00461                 $xcolumnNames=array_values(<a class="code" href="viewregistrants_8php.html#a1ca94d552a61d6947459c04d852ba271">getColumnList</a>(0, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>));
<a name="l00462"></a>00462                 $usertablefields2=array_merge($usertablefields,$xcolumnNames);
<a name="l00463"></a>00463                 <span class="keywordflow">for</span>($i=0;$i&lt;count($usertablefields2);$i++)
<a name="l00464"></a>00464                         <span class="keywordflow">if</span>(isset($_POST[$usertablefields2[$i].<span class="stringliteral">&#39;_sel&#39;</span>]))
<a name="l00465"></a>00465                                 $userForm.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;{$usertablefields2[$i]}_sel&#39; value=&#39;checked&#39;/&gt;&quot;</span>;
<a name="l00466"></a>00466                 $userForm.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;not_first_time&#39; /&gt;&quot;</span>;
<a name="l00467"></a>00467                 $infoarray=array();
<a name="l00468"></a>00468                 <span class="keywordflow">foreach</span> ($usertablefields as $field)
<a name="l00469"></a>00469                         $infoarray[$field]=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00470"></a>00470                 $infoarray[<span class="stringliteral">&#39;user_id&#39;</span>]=$nextUserId;
<a name="l00471"></a>00471                 
<a name="l00472"></a>00472                 $userForm.=<a class="code" href="users_8lib_8php.html#aeb3eab5260963cfb7ef73cc33d920206">userProfileForm</a>($userfieldprettynamesarray,$infoarray,<span class="keyword">false</span>,<span class="keyword">true</span>);
<a name="l00473"></a>00473                 
<a name="l00474"></a>00474                 $userForm.=<span class="stringliteral">&quot;&lt;input type=&#39;submit&#39; onclick name=&#39;create_user_submit&#39; value=&#39;Create&#39; /&gt;&lt;input type=&#39;reset&#39; value=&#39;Clear&#39; /&gt;&lt;/form&gt;&quot;</span>;
<a name="l00475"></a>00475                 <span class="keywordflow">return</span> $userForm;
<a name="l00476"></a>00476                 
<a name="l00477"></a>00477                 
<a name="l00478"></a>00478                 
<a name="l00479"></a>00479                 
<a name="l00480"></a>00480 
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482         
<a name="l00483"></a>00483 }
<a name="l00484"></a><a class="code" href="users_8lib_8php.html#addd613a87c632c869d9b6df6d73fc9a2">00484</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="users_8lib_8php.html#addd613a87c632c869d9b6df6d73fc9a2">getAllUsersInfo</a>(&amp;<a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>,&amp;$userName,&amp;$userEmail,&amp;$userFullName,&amp;$userPassword,&amp;$userLastLogin,&amp;$userRegDate,&amp;$userActivated,&amp;$userLoginMethod)
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486         <a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>=<span class="stringliteral">&quot;SELECT * FROM `&quot;</span>.MYSQL_DATABASE_PREFIX.<span class="stringliteral">&quot;users` ORDER BY `user_id` ASC&quot;</span>;
<a name="l00487"></a>00487         <a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>=mysql_query(<a class="code" href="import_contacts_8php.html#af59a5f7cd609e592c41dc3643efd3c98">$query</a>);
<a name="l00488"></a>00488         <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>=array();
<a name="l00489"></a>00489         $userEmail=array();
<a name="l00490"></a>00490         $userName=array();
<a name="l00491"></a>00491         $userFullName=array();
<a name="l00492"></a>00492         $userPassword=array();
<a name="l00493"></a>00493         $userLastLogin=array();
<a name="l00494"></a>00494         $userRegDate=array();
<a name="l00495"></a>00495         $userActivated=array();
<a name="l00496"></a>00496         $userLoginMethod=array();
<a name="l00497"></a>00497         $i=0;
<a name="l00498"></a>00498         <span class="keywordflow">while</span>($row=mysql_fetch_assoc(<a class="code" href="import_contacts_8php.html#a112ef069ddc0454086e3d1e6d8d55d07">$result</a>))
<a name="l00499"></a>00499         {
<a name="l00500"></a>00500                 <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>[$i]=$row[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00501"></a>00501                 $userName[$i]=$row[<span class="stringliteral">&#39;user_name&#39;</span>];
<a name="l00502"></a>00502                 $userEmail[$i]=$row[<span class="stringliteral">&#39;user_email&#39;</span>];
<a name="l00503"></a>00503         
<a name="l00504"></a>00504                 $userFullName[$i]=$row[<span class="stringliteral">&#39;user_fullname&#39;</span>];
<a name="l00505"></a>00505                 $userPassword[$i]=$row[<span class="stringliteral">&#39;user_password&#39;</span>];
<a name="l00506"></a>00506                 $userLastLogin[$i]=$row[<span class="stringliteral">&#39;user_lastlogin&#39;</span>];
<a name="l00507"></a>00507                 $userRegDate[$i]=$row[<span class="stringliteral">&#39;user_regdate&#39;</span>];
<a name="l00508"></a>00508                 $userActivated[$i]=$row[<span class="stringliteral">&#39;user_activated&#39;</span>];
<a name="l00509"></a>00509                 $userLoginMethod[$i]=$row[<span class="stringliteral">&#39;user_loginmethod&#39;</span>];
<a name="l00510"></a>00510                 $i++;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         
<a name="l00513"></a>00513 }
<a name="l00514"></a><a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">00514</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="users_8lib_8php.html#aaa3c94f4bf75006f79fc76fc61e4d84c">registeredUsersList</a>($type,$act,$allfields,$userInfo=NULL)
<a name="l00515"></a>00515 {
<a name="l00516"></a>00516         global <a class="code" href="icons_8lib_8php.html#aedb76478d4528f9a7238cb660ba23f41">$urlRequestRoot</a>, <a class="code" href="icons_8lib_8php.html#a0fa2c9191ec4f6bb08bd885031af226c">$cmsFolder</a>, <a class="code" href="common_8lib_8php.html#aff25c40f48b4e124ac84533f8dbd0b4d">$moduleFolder</a>, <a class="code" href="icons_8lib_8php.html#a2654f4b5167de5bf124544b36647f7c4">$templateFolder</a>,<a class="code" href="common_8lib_8php.html#af6e6b8785607da4a06f0ab2ebd67e518">$sourceFolder</a>;
<a name="l00517"></a>00517         require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/viewregistrants.php&quot;</span>);
<a name="l00518"></a>00518         $extraColumns=<a class="code" href="viewregistrants_8php.html#a1ca94d552a61d6947459c04d852ba271">getColumnList</a>(0, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);
<a name="l00519"></a>00519         $xcolumnIds=array(); $xcolumnNames=array(); $xcolumnFieldVars=array();
<a name="l00520"></a>00520         <span class="keywordflow">foreach</span>($extraColumns as $columnid=&gt;$colname)
<a name="l00521"></a>00521         {
<a name="l00522"></a>00522          $xcolumnIds[]=$columnid;
<a name="l00523"></a>00523          $xcolumnNames[]=$colname;
<a name="l00524"></a>00524          $xcolumnFieldVars[]=<span class="stringliteral">&#39;user&#39;</span>.ucfirst($colname);
<a name="l00525"></a>00525          ${<span class="stringliteral">&#39;user&#39;</span>.ucfirst($colname)}=array();
<a name="l00526"></a>00526         }
<a name="l00527"></a>00527         
<a name="l00528"></a>00528         <span class="keywordflow">if</span>($userInfo==NULL)
<a name="l00529"></a>00529         {
<a name="l00530"></a>00530          <a class="code" href="users_8lib_8php.html#addd613a87c632c869d9b6df6d73fc9a2">getAllUsersInfo</a>(<a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>,$userName,$userEmail,$userFullName,$userPassword,$userLastLogin,$userRegDate,$userActivated,$userLoginMethod); 
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532         <span class="keywordflow">else</span> 
<a name="l00533"></a>00533         {
<a name="l00534"></a>00534                 <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>=$userInfo[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00535"></a>00535                 $userName=$userInfo[<span class="stringliteral">&#39;user_name&#39;</span>];
<a name="l00536"></a>00536                 $userEmail=$userInfo[<span class="stringliteral">&#39;user_email&#39;</span>];
<a name="l00537"></a>00537         
<a name="l00538"></a>00538                 $userFullName=$userInfo[<span class="stringliteral">&#39;user_fullname&#39;</span>];
<a name="l00539"></a>00539                 $userPassword=$userInfo[<span class="stringliteral">&#39;user_password&#39;</span>];
<a name="l00540"></a>00540                 $userLastLogin=$userInfo[<span class="stringliteral">&#39;user_lastlogin&#39;</span>];
<a name="l00541"></a>00541                 $userRegDate=$userInfo[<span class="stringliteral">&#39;user_regdate&#39;</span>];
<a name="l00542"></a>00542                 $userActivated=$userInfo[<span class="stringliteral">&#39;user_activated&#39;</span>];
<a name="l00543"></a>00543                 $userLoginMethod=$userInfo[<span class="stringliteral">&#39;user_loginmethod&#39;</span>];
<a name="l00544"></a>00544                 
<a name="l00545"></a>00545         }
<a name="l00546"></a>00546          <span class="keywordflow">foreach</span>(<a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a> as $userid)
<a name="l00547"></a>00547                  {
<a name="l00548"></a>00548                         $xinfo=<a class="code" href="viewregistrants_8php.html#ab9e4118a83d62d24c00d6640080e91e3">generateFormDataRow</a>(0,$userid,$xcolumnIds);
<a name="l00549"></a>00549                         <span class="keywordflow">foreach</span>($xinfo as $j=&gt;$info)
<a name="l00550"></a>00550                         {
<a name="l00551"></a>00551                                 ${$xcolumnFieldVars[$j]}[]=$info;
<a name="l00552"></a>00552                         }
<a name="l00553"></a>00553                 }
<a name="l00554"></a>00554 
<a name="l00555"></a>00555         
<a name="l00556"></a>00556         
<a name="l00557"></a>00557         $userfieldprettynames=array_merge( array(<span class="stringliteral">&quot;User ID&quot;</span>,<span class="stringliteral">&quot;Username&quot;</span>,<span class="stringliteral">&quot;Email&quot;</span>,<span class="stringliteral">&quot;Full Name&quot;</span>,<span class="stringliteral">&quot;Password&quot;</span>,<span class="stringliteral">&quot;Registration&quot;</span>,<span class="stringliteral">&quot;Last Login&quot;</span>,<span class="stringliteral">&quot;Activated&quot;</span>,<span class="stringliteral">&quot;Login Method&quot;</span>), array_map(<span class="stringliteral">&#39;ucfirst&#39;</span>,$xcolumnNames));
<a name="l00558"></a>00558         
<a name="l00559"></a>00559         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> replace10byYesNo(&amp;$value,$key)
<a name="l00560"></a>00560         { <span class="keywordflow">if</span>($value==<span class="charliteral">&#39;1&#39;</span>) $value=<span class="stringliteral">&quot;Yes&quot;</span>; <span class="keywordflow">else</span> <span class="keywordflow">if</span> ($value==<span class="charliteral">&#39;0&#39;</span>) $value=<span class="stringliteral">&quot;No&quot;</span>; }
<a name="l00561"></a>00561         array_walk($userActivated,<span class="stringliteral">&#39;replace10byYesNo&#39;</span>);
<a name="l00562"></a>00562         
<a name="l00563"></a>00563         
<a name="l00564"></a>00564         $userlisttdids=array_merge(array(<span class="stringliteral">&quot;user_id&quot;</span>,<span class="stringliteral">&quot;user_name&quot;</span>,<span class="stringliteral">&quot;user_email&quot;</span>,<span class="stringliteral">&quot;user_fullname&quot;</span>,<span class="stringliteral">&quot;user_password&quot;</span>,<span class="stringliteral">&quot;user_regdate&quot;</span>,<span class="stringliteral">&quot;user_lastlogin&quot;</span>,<span class="stringliteral">&quot;user_activated&quot;</span>,<span class="stringliteral">&quot;user_loginmethod&quot;</span>), $xcolumnIds);
<a name="l00565"></a>00565         $userfieldvars=array_merge(array(<span class="stringliteral">&quot;userId&quot;</span>,<span class="stringliteral">&quot;userName&quot;</span>,<span class="stringliteral">&quot;userEmail&quot;</span>,<span class="stringliteral">&quot;userFullName&quot;</span>,<span class="stringliteral">&quot;userPassword&quot;</span>,<span class="stringliteral">&quot;userRegDate&quot;</span>,<span class="stringliteral">&quot;userLastLogin&quot;</span>,<span class="stringliteral">&quot;userActivated&quot;</span>,<span class="stringliteral">&quot;userLoginMethod&quot;</span>), $xcolumnFieldVars);
<a name="l00566"></a>00566         
<a name="l00567"></a>00567         $userlist=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00568"></a>00568         $columns=count($userfieldvars);
<a name="l00569"></a>00569         <span class="keywordflow">if</span>($act==<span class="stringliteral">&quot;edit&quot;</span>)
<a name="l00570"></a>00570         {
<a name="l00571"></a>00571                 $userlist.=<span class="stringliteral">&quot;&lt;form name=&#39;user_edit_form&#39; method=&#39;POST&#39; action=&#39;./+admin&amp;subaction=useradmin&amp;userid=&#39; &gt;\n&quot;</span>;
<a name="l00572"></a>00572                 $userlist.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;editusertype&#39; value=&#39;$type&#39; /&gt;&quot;</span>;
<a name="l00573"></a>00573                 $columns+=3;
<a name="l00574"></a>00574         }
<a name="l00575"></a>00575         $userlist .= <a class="code" href="classsmarttable.html#a2a61fd65b31e7b27adb58e9b77865386">smarttable::render</a>(array(<span class="stringliteral">&#39;userstable&#39;</span>),null);
<a name="l00576"></a>00576         global <a class="code" href="index_8php.html#a3fbe1358b48457ae3788922694d20ea2" title="Will contain a string containing all that has to be executed on window load.">$STARTSCRIPTS</a>;
<a name="l00577"></a>00577         $STARTSCRIPTS.=<span class="stringliteral">&quot;initSmartTable();&quot;</span>;
<a name="l00578"></a>00578         
<a name="l00579"></a>00579         $userlist.=&lt;&lt;&lt;USERLIST
<a name="l00580"></a>00580         
<a name="l00581"></a>00581         &lt;script language=<span class="stringliteral">&quot;javascript&quot;</span>&gt;
<a name="l00582"></a>00582         <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> checkDelete(butt,userDel,userId)
<a name="l00583"></a>00583         {
<a name="l00584"></a>00584                 <span class="keywordflow">if</span>(confirm(<span class="stringliteral">&#39;Are you sure you want to delete &#39;</span>+userDel+<span class="stringliteral">&#39; (User ID=&#39;</span>+userId+<span class="stringliteral">&#39;)?&#39;</span>))
<a name="l00585"></a>00585                 {
<a name="l00586"></a>00586                         butt.form.action+=userId;
<a name="l00587"></a>00587                 }
<a name="l00588"></a>00588                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00589"></a>00589         }
<a name="l00590"></a>00590         &lt;/script&gt;
<a name="l00591"></a>00591         &lt;a <a class="code" href="template_8lib_8php.html#a824aa20276005f0889ccb9ff6f1c5efd">name</a>=<span class="stringliteral">&#39;userlist&#39;</span>&gt;&lt;/a&gt;&lt;table <span class="keyword">class</span>=<span class="stringliteral">&quot;userlisttable display&quot;</span> border=<span class="stringliteral">&quot;1&quot;</span> <span class="keywordtype">id</span>=<span class="stringliteral">&#39;userstable&#39;</span>&gt;
<a name="l00592"></a>00592         &lt;thead&gt;
<a name="l00593"></a>00593         &lt;tr&gt;&lt;th colspan=<span class="stringliteral">&quot;$columns&quot;</span>&gt;Users Registered on the Website&lt;/th&gt;&lt;/tr&gt;
<a name="l00594"></a>00594         &lt;tr&gt;
<a name="l00595"></a>00595 USERLIST;
<a name="l00596"></a>00596 
<a name="l00597"></a>00597                 
<a name="l00598"></a>00598         
<a name="l00599"></a>00599         $defCols=<a class="code" href="common_8lib_8php.html#ac8532aedf62e151b720f899097f298c2">getTableFieldsName</a>(<span class="stringliteral">&#39;users&#39;</span>);
<a name="l00600"></a>00600         $usertablefields=array_merge($defCols,$xcolumnIds);
<a name="l00601"></a>00601         $displayfieldsindex=array();
<a name="l00602"></a>00602         $c=0;
<a name="l00603"></a>00603         <span class="keywordflow">for</span>($i=0;$i&lt;count($usertablefields);$i++)
<a name="l00604"></a>00604         {
<a name="l00605"></a>00605                 <span class="keywordflow">if</span>(isset($_POST[$usertablefields[$i].<span class="stringliteral">&#39;_sel&#39;</span>]) || $allfields)
<a name="l00606"></a>00606                 {
<a name="l00607"></a>00607                         $userlist.=<span class="stringliteral">&quot;&lt;th&gt;&quot;</span>.$userfieldprettynames[$i];
<a name="l00608"></a>00608                         <span class="keywordflow">if</span>($act==<span class="stringliteral">&quot;edit&quot;</span>) $userlist.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;{$usertablefields[$i]}_sel&#39; value=&#39;checked&#39;/&gt;&quot;</span>;
<a name="l00609"></a>00609                         $userlist.=<span class="stringliteral">&quot;&lt;/th&gt;&quot;</span>;
<a name="l00610"></a>00610                         $displayfieldsindex[$c++]=$i;
<a name="l00611"></a>00611                 }
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613         
<a name="l00614"></a>00614         
<a name="l00615"></a>00615         $userlist.=<span class="stringliteral">&quot;&lt;input type=&#39;hidden&#39; name=&#39;not_first_time&#39; /&gt;&quot;</span>;
<a name="l00616"></a>00616                 
<a name="l00617"></a>00617         
<a name="l00618"></a>00618         <span class="keywordflow">if</span>($act==<span class="stringliteral">&quot;edit&quot;</span>)
<a name="l00619"></a>00619         {
<a name="l00620"></a>00620                 $userlist.=<span class="stringliteral">&quot;&lt;th&gt;Actions&lt;/th&gt;&quot;</span>;
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622         $userlist.=<span class="stringliteral">&quot;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;</span>;
<a name="l00623"></a>00623         $rowclass=<span class="stringliteral">&quot;oddrow&quot;</span>;
<a name="l00624"></a>00624         $flag=<span class="keyword">false</span>;
<a name="l00625"></a>00625         $usercount=0;
<a name="l00626"></a>00626         global <a class="code" href="index_8php.html#a230fc573246b14390d9e8aef2f7daa59" title="Stores all the icons locations without the.">$ICONS_SRC</a>;
<a name="l00627"></a>00627         <span class="keywordflow">for</span>($i=0; $i&lt;count(<a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>); $i++)
<a name="l00628"></a>00628         {
<a name="l00629"></a>00629                 <span class="keywordflow">if</span>($type==<span class="stringliteral">&quot;activated&quot;</span> &amp;&amp; $userActivated[$i]==<span class="stringliteral">&quot;No&quot;</span>)
<a name="l00630"></a>00630                         <span class="keywordflow">continue</span>;
<a name="l00631"></a>00631                 <span class="keywordflow">if</span>($type==<span class="stringliteral">&quot;nonactivated&quot;</span> &amp;&amp; $userActivated[$i]==<span class="stringliteral">&quot;Yes&quot;</span>)
<a name="l00632"></a>00632                         <span class="keywordflow">continue</span>;
<a name="l00633"></a>00633                 $flag=<span class="keyword">true</span>;
<a name="l00634"></a>00634                 $userlist.=<span class="stringliteral">&quot;&lt;tr class=&#39;$rowclass&#39;&gt;&quot;</span>;
<a name="l00635"></a>00635                 
<a name="l00636"></a>00636                 <span class="keywordflow">for</span>($j=0; $j&lt;count($displayfieldsindex); $j++)
<a name="l00637"></a>00637                 {
<a name="l00638"></a>00638                         $userlist.=<span class="stringliteral">&quot;&lt;td class=&#39;{$userlisttdids[$j]}&#39;&gt;&quot;</span>.${$userfieldvars[$displayfieldsindex[$j]]}[$i].<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;  
<a name="l00639"></a>00639                 }
<a name="l00640"></a>00640                 
<a name="l00641"></a>00641                 
<a name="l00642"></a>00642                 <span class="keywordflow">if</span>($act==<span class="stringliteral">&quot;edit&quot;</span>)
<a name="l00643"></a>00643                 {
<a name="l00644"></a>00644                         $userlist.=<span class="stringliteral">&quot;&lt;td id=&#39;user_editactions&#39;&gt;&quot;</span>;
<a name="l00645"></a>00645                         <span class="keywordflow">if</span>($userActivated[$i]==<span class="stringliteral">&quot;No&quot;</span>)
<a name="l00646"></a>00646                                 $userlist.=<span class="stringliteral">&quot;&lt;input title=&#39;Activate User&#39; type=&#39;image&#39; src=&#39;{$ICONS_SRC[&#39;Activate&#39;][&#39;small&#39;]}&#39; onclick=\&quot;this.form.action+=&#39;{$userId[$i]}&#39;\&quot; name=&#39;user_activate&#39; value=&#39;Activate&#39;&gt;\n&quot;</span>;
<a name="l00647"></a>00647                         <span class="keywordflow">else</span> $userlist.=<span class="stringliteral">&quot;&lt;input  title=&#39;Deactivate User&#39; type=&#39;image&#39; src=&#39;{$ICONS_SRC[&#39;Deactivate&#39;][&#39;small&#39;]}&#39; onclick=\&quot;this.form.action+=&#39;{$userId[$i]}&#39;\&quot; name=&#39;user_deactivate&#39; value=&#39;Deactivate&#39;&gt;\n&quot;</span>;
<a name="l00648"></a>00648                         $userlist.=<span class="stringliteral">&quot;&lt;input  title=&#39;Edit User&#39; type=&#39;image&#39; src=&#39;{$ICONS_SRC[&#39;Edit&#39;][&#39;small&#39;]}&#39; onclick=\&quot;this.form.action+=&#39;{$userId[$i]}&#39;\&quot; name=&#39;user_info&#39; value=&#39;Edit&#39;&gt;\n&quot;</span>;
<a name="l00649"></a>00649                         $userlist.=<span class="stringliteral">&quot;&lt;input  title=&#39;Delete User&#39; type=&#39;image&#39; src=&#39;{$ICONS_SRC[&#39;Delete&#39;][&#39;small&#39;]}&#39; onclick=\&quot;return checkDelete(this,&#39;&quot;</span>.$userName[$i].<span class="stringliteral">&quot;&#39;,&#39;&quot;</span>.<a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>[$i].<span class="stringliteral">&quot;&#39;)\&quot; name=&#39;user_delete&#39; value=&#39;Delete&#39;&gt;\n&quot;</span>;
<a name="l00650"></a>00650                         $userlist.=<span class="stringliteral">&quot;&lt;/td&gt;&quot;</span>;
<a name="l00651"></a>00651                         
<a name="l00652"></a>00652                 }
<a name="l00653"></a>00653                 $userlist.=<span class="stringliteral">&quot;&lt;/tr&gt;&quot;</span>;
<a name="l00654"></a>00654                 $rowclass=$rowclass==<span class="stringliteral">&quot;evenrow&quot;</span>?<span class="stringliteral">&quot;oddrow&quot;</span>:<span class="stringliteral">&quot;evenrow&quot;</span>;
<a name="l00655"></a>00655                 $usercount++;
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657         $userlist.=<span class="stringliteral">&quot;&lt;/tbody&gt;&lt;/table&gt;&quot;</span>;
<a name="l00658"></a>00658         <span class="keywordflow">if</span>($act==<span class="stringliteral">&quot;edit&quot;</span>) $userlist.=<span class="stringliteral">&quot;&lt;/form&gt;&quot;</span>;
<a name="l00659"></a>00659         
<a name="l00660"></a>00660         
<a name="l00661"></a>00661         <span class="keywordflow">return</span> ($flag)?$userlist:<span class="stringliteral">&quot;No Users Found!&quot;</span>;
<a name="l00662"></a>00662 }
<a name="l00663"></a><a class="code" href="users_8lib_8php.html#aeb3eab5260963cfb7ef73cc33d920206">00663</a> <a class="code" href="cms_2templates_2pv3_2index_8php.html#a3d59d9110a163fdc9c81f6f02f628ea2">function</a> <a class="code" href="users_8lib_8php.html#aeb3eab5260963cfb7ef73cc33d920206">userProfileForm</a>($userfieldprettynames,$profileInfoRows,$editID=<span class="keyword">false</span>,$showProfileInfo=<span class="keyword">true</span>)
<a name="l00664"></a>00664 {
<a name="l00665"></a>00665         $i=0;
<a name="l00666"></a>00666         $userinfo=<span class="stringliteral">&quot;&lt;table&gt;&quot;</span>;
<a name="l00667"></a>00667         <span class="keywordflow">foreach</span> ($profileInfoRows as $field =&gt; $value)
<a name="l00668"></a>00668         {
<a name="l00669"></a>00669                 <span class="keywordflow">if</span>($field==<span class="stringliteral">&#39;user_password&#39;</span>)
<a name="l00670"></a>00670                 {
<a name="l00671"></a>00671                         $userinfo.=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;{$userfieldprettynames[$i]}&lt;/td&gt;&lt;td&gt;&lt;input type=&#39;password&#39; name=&#39;$field&#39;/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00672"></a>00672                         $field.=<span class="charliteral">&#39;2&#39;</span>;
<a name="l00673"></a>00673                         $userinfo.=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;{$userfieldprettynames[$i++]} (Verify)&lt;/td&gt;&lt;td&gt;&lt;input type=&#39;password&#39; name=&#39;$field&#39;/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00674"></a>00674                 }
<a name="l00675"></a>00675                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>($field==<span class="stringliteral">&#39;user_activated&#39;</span>)
<a name="l00676"></a>00676                 {
<a name="l00677"></a>00677                         $value=($value==1)?<span class="stringliteral">&quot;checked&quot;</span>:<span class="stringliteral">&quot;&quot;</span>;
<a name="l00678"></a>00678                         $userinfo.=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;{$userfieldprettynames[$i++]}&lt;/td&gt;&lt;td&gt;&lt;input type=&#39;checkbox&#39; name=&#39;$field&#39; $value /&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00679"></a>00679                 }
<a name="l00680"></a>00680                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>($field==<span class="stringliteral">&#39;user_loginmethod&#39;</span>)
<a name="l00681"></a>00681                 {
<a name="l00682"></a>00682                         $ldapsel=$imapsel=$adssel=$dbsel=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00683"></a>00683                         ${$profileInfoRows[$field].<span class="stringliteral">&#39;sel&#39;</span>}=<span class="stringliteral">&quot; selected = &#39;selected&#39; &quot;</span>;
<a name="l00684"></a>00684                         $userinfo.=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;{$userfieldprettynames[$i++]}&lt;/td&gt;&lt;td&gt;&lt;select id=&#39;$field&#39; name=&#39;$field&#39;&gt;</span>
<a name="l00685"></a>00685 <span class="stringliteral">                        &lt;option&gt;&lt;/option&gt;</span>
<a name="l00686"></a>00686 <span class="stringliteral">                        &lt;option $ldapsel&gt;ldap&lt;/option&gt;</span>
<a name="l00687"></a>00687 <span class="stringliteral">                        &lt;option $imapsel&gt;imap&lt;/option&gt;</span>
<a name="l00688"></a>00688 <span class="stringliteral">                        &lt;option $adssel&gt;ads&lt;/option&gt;</span>
<a name="l00689"></a>00689 <span class="stringliteral">                        &lt;option $dbsel&gt;db&lt;/option&gt;</span>
<a name="l00690"></a>00690 <span class="stringliteral">                        &lt;/select&gt;</span>
<a name="l00691"></a>00691 <span class="stringliteral">                        &lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00692"></a>00692                 }
<a name="l00693"></a>00693                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>((!$editID &amp;&amp; $field==<span class="stringliteral">&#39;user_id&#39;</span>) || (!$editID &amp;&amp; $field==<span class="stringliteral">&#39;user_regdate&#39;</span>))
<a name="l00694"></a>00694                         $userinfo.=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;{$userfieldprettynames[$i++]}&lt;/td&gt;&lt;td&gt;$value&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00695"></a>00695                 
<a name="l00696"></a>00696                 <span class="keywordflow">else</span> $userinfo.=<span class="stringliteral">&quot;&lt;tr&gt;&lt;td&gt;{$userfieldprettynames[$i++]}&lt;/td&gt;&lt;td&gt;&lt;input type=&#39;text&#39; name=&#39;$field&#39; value=&#39;$value&#39;/&gt;&lt;/td&gt;&lt;/tr&gt;&quot;</span>;
<a name="l00697"></a>00697                 
<a name="l00698"></a>00698         }
<a name="l00699"></a>00699         
<a name="l00700"></a>00700         <span class="keywordflow">if</span>($showProfileInfo)
<a name="l00701"></a>00701         {
<a name="l00702"></a>00702                 global <a class="code" href="common_8lib_8php.html#af6e6b8785607da4a06f0ab2ebd67e518">$sourceFolder</a>,<a class="code" href="common_8lib_8php.html#aff25c40f48b4e124ac84533f8dbd0b4d">$moduleFolder</a>;
<a name="l00703"></a>00703                 require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformsubmit.php&quot;</span>);
<a name="l00704"></a>00704                 require_once(<span class="stringliteral">&quot;$sourceFolder/$moduleFolder/form/registrationformgenerate.php&quot;</span>);
<a name="l00705"></a>00705                 $containsFileUploadFields = <span class="keyword">false</span>;
<a name="l00706"></a>00706                 <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>=$profileInfoRows[<span class="stringliteral">&#39;user_id&#39;</span>];
<a name="l00707"></a>00707                 $dynamicFields = <a class="code" href="registrationformgenerate_8php.html#a278216352f218654b56ca3fde52c62fd">getFormElementsHtmlAsArray</a>(0, <a class="code" href="index_8php.html#a84651f4070d04080f6c5fd3c98cc9104">$userId</a>, $jsValidationFunctions, $containsFileUploadFields);
<a name="l00708"></a>00708                 $dynamicFields = join($dynamicFields, <span class="stringliteral">&quot;&lt;/tr&gt;\n&lt;tr&gt;&quot;</span>);
<a name="l00709"></a>00709                 <span class="keywordflow">if</span>($dynamicFields != <span class="stringliteral">&#39;&#39;</span>) {
<a name="l00710"></a>00710                         $dynamicFields = <span class="stringliteral">&quot;&lt;tr&gt;$dynamicFields&lt;/tr&gt;&quot;</span>;
<a name="l00711"></a>00711                 }
<a name="l00712"></a>00712                 $userinfo.=$dynamicFields;
<a name="l00713"></a>00713         }
<a name="l00714"></a>00714         
<a name="l00715"></a>00715         <span class="keywordflow">return</span> $userinfo.<span class="stringliteral">&quot;&lt;/table&gt;&quot;</span>;
<a name="l00716"></a>00716 }
<a name="l00717"></a>00717 ?&gt;
</pre></div></div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Sun Jan 2 2011 04:55:32 for Pragyan CMS by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
